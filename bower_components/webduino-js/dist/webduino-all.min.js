"undefined"==typeof Paho&&(Paho={}),Paho.MQTT=function(e){function t(e,t){var i=t,n=e[t],o=n>>4,r=n&=15;t+=1;var a,u=0,l=1;do{if(t==e.length)return[null,i];a=e[t++],u+=(127&a)*l,l*=128}while(0!=(128&a));var d=t+u;if(d>e.length)return[null,i];var _=new v(o);switch(o){case h.CONNACK:var f=e[t++];1&f&&(_.sessionPresent=!0),_.returnCode=e[t++];break;case h.PUBLISH:var p=r>>1&3,g=s(e,t);t+=2;var m=c(e,t,g);t+=g,p>0&&(_.messageIdentifier=s(e,t),t+=2);var E=new Paho.MQTT.Message(e.subarray(t,d));1==(1&r)&&(E.retained=!0),8==(8&r)&&(E.duplicate=!0),E.qos=p,E.destinationName=m,_.payloadMessage=E;break;case h.PUBACK:case h.PUBREC:case h.PUBREL:case h.PUBCOMP:case h.UNSUBACK:_.messageIdentifier=s(e,t);break;case h.SUBACK:_.messageIdentifier=s(e,t),t+=2,_.returnCode=e.subarray(t,d)}return[_,d]}function i(e,t,i){return t[i++]=e>>8,t[i++]=e%256,i}function n(e,t,n,s){return s=i(t,n,s),a(e,n,s),s+t}function s(e,t){return 256*e[t]+e[t+1]}function o(e){var t=new Array(1),i=0;do{var n=e%128;e>>=7,e>0&&(n|=128),t[i++]=n}while(e>0&&4>i);return t}function r(e){for(var t=0,i=0;i<e.length;i++){var n=e.charCodeAt(i);n>2047?(n>=55296&&56319>=n&&(i++,t++),t+=3):n>127?t+=2:t++}return t}function a(e,t,i){for(var n=i,s=0;s<e.length;s++){var o=e.charCodeAt(s);if(o>=55296&&56319>=o){var r=e.charCodeAt(++s);if(isNaN(r))throw new Error(p(_.MALFORMED_UNICODE,[o,r]));o=(o-55296<<10)+(r-56320)+65536}127>=o?t[n++]=o:2047>=o?(t[n++]=o>>6&31|192,t[n++]=63&o|128):65535>=o?(t[n++]=o>>12&15|224,t[n++]=o>>6&63|128,t[n++]=63&o|128):(t[n++]=o>>18&7|240,t[n++]=o>>12&63|128,t[n++]=o>>6&63|128,t[n++]=63&o|128)}return t}function c(e,t,i){for(var n,s="",o=t;t+i>o;){var r=e[o++];if(128>r)n=r;else{var a=e[o++]-128;if(0>a)throw new Error(p(_.MALFORMED_UTF,[r.toString(16),a.toString(16),""]));if(224>r)n=64*(r-192)+a;else{var c=e[o++]-128;if(0>c)throw new Error(p(_.MALFORMED_UTF,[r.toString(16),a.toString(16),c.toString(16)]));if(240>r)n=4096*(r-224)+64*a+c;else{var u=e[o++]-128;if(0>u)throw new Error(p(_.MALFORMED_UTF,[r.toString(16),a.toString(16),c.toString(16),u.toString(16)]));if(!(248>r))throw new Error(p(_.MALFORMED_UTF,[r.toString(16),a.toString(16),c.toString(16),u.toString(16)]));n=262144*(r-240)+4096*a+64*c+u}}}n>65535&&(n-=65536,s+=String.fromCharCode(55296+(n>>10)),n=56320+(1023&n)),s+=String.fromCharCode(n)}return s}var u="@VERSION@",h={CONNECT:1,CONNACK:2,PUBLISH:3,PUBACK:4,PUBREC:5,PUBREL:6,PUBCOMP:7,SUBSCRIBE:8,SUBACK:9,UNSUBSCRIBE:10,UNSUBACK:11,PINGREQ:12,PINGRESP:13,DISCONNECT:14},l=function(e,t){for(var i in e)if(e.hasOwnProperty(i)){if(!t.hasOwnProperty(i)){var n="Unknown property, "+i+". Valid properties are:";for(var i in t)t.hasOwnProperty(i)&&(n=n+" "+i);throw new Error(n)}if(typeof e[i]!==t[i])throw new Error(p(_.INVALID_TYPE,[typeof e[i],i]))}},d=function(e,t){return function(){return e.apply(t,arguments)}},_={OK:{code:0,text:"AMQJSC0000I OK."},CONNECT_TIMEOUT:{code:1,text:"AMQJSC0001E Connect timed out."},SUBSCRIBE_TIMEOUT:{code:2,text:"AMQJS0002E Subscribe timed out."},UNSUBSCRIBE_TIMEOUT:{code:3,text:"AMQJS0003E Unsubscribe timed out."},PING_TIMEOUT:{code:4,text:"AMQJS0004E Ping timed out."},INTERNAL_ERROR:{code:5,text:"AMQJS0005E Internal error. Error Message: {0}, Stack trace: {1}"},CONNACK_RETURNCODE:{code:6,text:"AMQJS0006E Bad Connack return code:{0} {1}."},SOCKET_ERROR:{code:7,text:"AMQJS0007E Socket error:{0}."},SOCKET_CLOSE:{code:8,text:"AMQJS0008I Socket closed."},MALFORMED_UTF:{code:9,text:"AMQJS0009E Malformed UTF data:{0} {1} {2}."},UNSUPPORTED:{code:10,text:"AMQJS0010E {0} is not supported by this browser."},INVALID_STATE:{code:11,text:"AMQJS0011E Invalid state {0}."},INVALID_TYPE:{code:12,text:"AMQJS0012E Invalid type {0} for {1}."},INVALID_ARGUMENT:{code:13,text:"AMQJS0013E Invalid argument {0} for {1}."},UNSUPPORTED_OPERATION:{code:14,text:"AMQJS0014E Unsupported operation."},INVALID_STORED_DATA:{code:15,text:"AMQJS0015E Invalid data in local storage key={0} value={1}."},INVALID_MQTT_MESSAGE_TYPE:{code:16,text:"AMQJS0016E Invalid MQTT message type {0}."},MALFORMED_UNICODE:{code:17,text:"AMQJS0017E Malformed Unicode string:{0} {1}."}},f={0:"Connection Accepted",1:"Connection Refused: unacceptable protocol version",2:"Connection Refused: identifier rejected",3:"Connection Refused: server unavailable",4:"Connection Refused: bad user name or password",5:"Connection Refused: not authorized"},p=function(e,t){var i=e.text;if(t)for(var n,s,o=0;o<t.length;o++)if(n="{"+o+"}",s=i.indexOf(n),s>0){var r=i.substring(0,s),a=i.substring(s+n.length);i=r+t[o]+a}return i},g=[0,6,77,81,73,115,100,112,3],m=[0,4,77,81,84,84,4],v=function(e,t){this.type=e;for(var i in t)t.hasOwnProperty(i)&&(this[i]=t[i])};v.prototype.encode=function(){var e=(15&this.type)<<4,t=0,s=new Array,a=0;switch(void 0!=this.messageIdentifier&&(t+=2),this.type){case h.CONNECT:switch(this.mqttVersion){case 3:t+=g.length+3;break;case 4:t+=m.length+3}if(t+=r(this.clientId)+2,void 0!=this.willMessage){t+=r(this.willMessage.destinationName)+2;var c=this.willMessage.payloadBytes;c instanceof Uint8Array||(c=new Uint8Array(l)),t+=c.byteLength+2}void 0!=this.userName&&(t+=r(this.userName)+2),void 0!=this.password&&(t+=r(this.password)+2);break;case h.SUBSCRIBE:e|=2;for(var u=0;u<this.topics.length;u++)s[u]=r(this.topics[u]),t+=s[u]+2;t+=this.requestedQos.length;break;case h.UNSUBSCRIBE:e|=2;for(var u=0;u<this.topics.length;u++)s[u]=r(this.topics[u]),t+=s[u]+2;break;case h.PUBREL:e|=2;break;case h.PUBLISH:this.payloadMessage.duplicate&&(e|=8),e=e|=this.payloadMessage.qos<<1,this.payloadMessage.retained&&(e|=1),a=r(this.payloadMessage.destinationName),t+=a+2;var l=this.payloadMessage.payloadBytes;t+=l.byteLength,l instanceof ArrayBuffer?l=new Uint8Array(l):l instanceof Uint8Array||(l=new Uint8Array(l.buffer));break;case h.DISCONNECT:}var d=o(t),_=d.length+1,f=new ArrayBuffer(t+_),p=new Uint8Array(f);if(p[0]=e,p.set(d,1),this.type==h.PUBLISH)_=n(this.payloadMessage.destinationName,a,p,_);else if(this.type==h.CONNECT){switch(this.mqttVersion){case 3:p.set(g,_),_+=g.length;break;case 4:p.set(m,_),_+=m.length}var v=0;this.cleanSession&&(v=2),void 0!=this.willMessage&&(v|=4,v|=this.willMessage.qos<<3,this.willMessage.retained&&(v|=32)),void 0!=this.userName&&(v|=128),void 0!=this.password&&(v|=64),p[_++]=v,_=i(this.keepAliveInterval,p,_)}switch(void 0!=this.messageIdentifier&&(_=i(this.messageIdentifier,p,_)),this.type){case h.CONNECT:_=n(this.clientId,r(this.clientId),p,_),void 0!=this.willMessage&&(_=n(this.willMessage.destinationName,r(this.willMessage.destinationName),p,_),_=i(c.byteLength,p,_),p.set(c,_),_+=c.byteLength),void 0!=this.userName&&(_=n(this.userName,r(this.userName),p,_)),void 0!=this.password&&(_=n(this.password,r(this.password),p,_));break;case h.PUBLISH:p.set(l,_);break;case h.SUBSCRIBE:for(var u=0;u<this.topics.length;u++)_=n(this.topics[u],s[u],p,_),p[_++]=this.requestedQos[u];break;case h.UNSUBSCRIBE:for(var u=0;u<this.topics.length;u++)_=n(this.topics[u],s[u],p,_)}return f};var E=function(e,t,i){this._client=e,this._window=t,this._keepAliveInterval=1e3*i,this.isReset=!1;var n=new v(h.PINGREQ).encode(),s=function(e){return function(){return o.apply(e)}},o=function(){this.isReset?(this.isReset=!1,this._client._trace("Pinger.doPing","send PINGREQ"),this._client.socket.send(n),this.timeout=this._window.setTimeout(s(this),this._keepAliveInterval)):(this._client._trace("Pinger.doPing","Timed out"),this._client._disconnected(_.PING_TIMEOUT.code,p(_.PING_TIMEOUT)))};this.reset=function(){this.isReset=!0,this._window.clearTimeout(this.timeout),this._keepAliveInterval>0&&(this.timeout=setTimeout(s(this),this._keepAliveInterval))},this.cancel=function(){this._window.clearTimeout(this.timeout)}},y=function(e,t,i,n,s){this._window=t,i||(i=30);var o=function(e,t,i){return function(){return e.apply(t,i)}};this.timeout=setTimeout(o(n,e,s),1e3*i),this.cancel=function(){this._window.clearTimeout(this.timeout)}},b=function(t,i,n,s,o){if(!("WebSocket"in e&&null!==e.WebSocket))throw new Error(p(_.UNSUPPORTED,["WebSocket"]));if(!("localStorage"in e&&null!==e.localStorage))throw new Error(p(_.UNSUPPORTED,["localStorage"]));if(!("ArrayBuffer"in e&&null!==e.ArrayBuffer))throw new Error(p(_.UNSUPPORTED,["ArrayBuffer"]));this._trace("Paho.MQTT.Client",t,i,n,s,o),this.host=i,this.port=n,this.path=s,this.uri=t,this.clientId=o,this._localKey=i+":"+n+("/mqtt"!=s?":"+s:"")+":"+o+":",this._msg_queue=[],this._sentMessages={},this._receivedMessages={},this._notify_msg_sent={},this._message_identifier=1,this._sequence=0;for(var r in localStorage)(0==r.indexOf("Sent:"+this._localKey)||0==r.indexOf("Received:"+this._localKey))&&this.restore(r)};b.prototype.host,b.prototype.port,b.prototype.path,b.prototype.uri,b.prototype.clientId,b.prototype.socket,b.prototype.connected=!1,b.prototype.maxMessageIdentifier=65536,b.prototype.connectOptions,b.prototype.hostIndex,b.prototype.onConnectionLost,b.prototype.onMessageDelivered,b.prototype.onMessageArrived,b.prototype.traceFunction,b.prototype._msg_queue=null,b.prototype._connectTimeout,b.prototype.sendPinger=null,b.prototype.receivePinger=null,b.prototype.receiveBuffer=null,b.prototype._traceBuffer=null,b.prototype._MAX_TRACE_ENTRIES=100,b.prototype.connect=function(e){var t=this._traceMask(e,"password");if(this._trace("Client.connect",t,this.socket,this.connected),this.connected)throw new Error(p(_.INVALID_STATE,["already connected"]));if(this.socket)throw new Error(p(_.INVALID_STATE,["already connected"]));this.connectOptions=e,e.uris?(this.hostIndex=0,this._doConnect(e.uris[0])):this._doConnect(this.uri)},b.prototype.subscribe=function(e,t){if(this._trace("Client.subscribe",e,t),!this.connected)throw new Error(p(_.INVALID_STATE,["not connected"]));var i=new v(h.SUBSCRIBE);i.topics=[e],i.requestedQos=void 0!=t.qos?[t.qos]:[0],t.onSuccess&&(i.onSuccess=function(e){t.onSuccess({invocationContext:t.invocationContext,grantedQos:e})}),t.onFailure&&(i.onFailure=function(e){t.onFailure({invocationContext:t.invocationContext,errorCode:e})}),t.timeout&&(i.timeOut=new y(this,window,t.timeout,t.onFailure,[{invocationContext:t.invocationContext,errorCode:_.SUBSCRIBE_TIMEOUT.code,errorMessage:p(_.SUBSCRIBE_TIMEOUT)}])),this._requires_ack(i),this._schedule_message(i)},b.prototype.unsubscribe=function(e,t){if(this._trace("Client.unsubscribe",e,t),!this.connected)throw new Error(p(_.INVALID_STATE,["not connected"]));var i=new v(h.UNSUBSCRIBE);i.topics=[e],t.onSuccess&&(i.callback=function(){t.onSuccess({invocationContext:t.invocationContext})}),t.timeout&&(i.timeOut=new y(this,window,t.timeout,t.onFailure,[{invocationContext:t.invocationContext,errorCode:_.UNSUBSCRIBE_TIMEOUT.code,errorMessage:p(_.UNSUBSCRIBE_TIMEOUT)}])),this._requires_ack(i),this._schedule_message(i)},b.prototype.send=function(e){if(this._trace("Client.send",e),!this.connected)throw new Error(p(_.INVALID_STATE,["not connected"]));wireMessage=new v(h.PUBLISH),wireMessage.payloadMessage=e,e.qos>0?this._requires_ack(wireMessage):this.onMessageDelivered&&(this._notify_msg_sent[wireMessage]=this.onMessageDelivered(wireMessage.payloadMessage)),this._schedule_message(wireMessage)},b.prototype.disconnect=function(){if(this._trace("Client.disconnect"),!this.socket)throw new Error(p(_.INVALID_STATE,["not connecting or connected"]));wireMessage=new v(h.DISCONNECT),this._notify_msg_sent[wireMessage]=d(this._disconnected,this),this._schedule_message(wireMessage)},b.prototype.getTraceLog=function(){if(null!==this._traceBuffer){this._trace("Client.getTraceLog",new Date),this._trace("Client.getTraceLog in flight messages",this._sentMessages.length);for(var e in this._sentMessages)this._trace("_sentMessages ",e,this._sentMessages[e]);for(var e in this._receivedMessages)this._trace("_receivedMessages ",e,this._receivedMessages[e]);return this._traceBuffer}},b.prototype.startTrace=function(){null===this._traceBuffer&&(this._traceBuffer=[]),this._trace("Client.startTrace",new Date,u)},b.prototype.stopTrace=function(){delete this._traceBuffer},b.prototype._doConnect=function(e){if(this.connectOptions.useSSL){var t=e.split(":");t[0]="wss",e=t.join(":")}this.connected=!1,this.socket=this.connectOptions.mqttVersion<4?new WebSocket(e,["mqttv3.1"]):new WebSocket(e,["mqtt"]),this.socket.binaryType="arraybuffer",this.socket.onopen=d(this._on_socket_open,this),this.socket.onmessage=d(this._on_socket_message,this),this.socket.onerror=d(this._on_socket_error,this),this.socket.onclose=d(this._on_socket_close,this),this.sendPinger=new E(this,window,this.connectOptions.keepAliveInterval),this.receivePinger=new E(this,window,this.connectOptions.keepAliveInterval),this._connectTimeout=new y(this,window,this.connectOptions.timeout,this._disconnected,[_.CONNECT_TIMEOUT.code,p(_.CONNECT_TIMEOUT)])},b.prototype._schedule_message=function(e){this._msg_queue.push(e),this.connected&&this._process_queue()},b.prototype.store=function(e,t){var i={type:t.type,messageIdentifier:t.messageIdentifier,version:1};switch(t.type){case h.PUBLISH:t.pubRecReceived&&(i.pubRecReceived=!0),i.payloadMessage={};for(var n="",s=t.payloadMessage.payloadBytes,o=0;o<s.length;o++)s[o]<=15?n=n+"0"+s[o].toString(16):n+=s[o].toString(16);i.payloadMessage.payloadHex=n,i.payloadMessage.qos=t.payloadMessage.qos,i.payloadMessage.destinationName=t.payloadMessage.destinationName,t.payloadMessage.duplicate&&(i.payloadMessage.duplicate=!0),t.payloadMessage.retained&&(i.payloadMessage.retained=!0),0==e.indexOf("Sent:")&&(void 0===t.sequence&&(t.sequence=++this._sequence),i.sequence=t.sequence);break;default:throw Error(p(_.INVALID_STORED_DATA,[key,i]))}localStorage.setItem(e+this._localKey+t.messageIdentifier,JSON.stringify(i))},b.prototype.restore=function(e){var t=localStorage.getItem(e),i=JSON.parse(t),n=new v(i.type,i);switch(i.type){case h.PUBLISH:for(var s=i.payloadMessage.payloadHex,o=new ArrayBuffer(s.length/2),r=new Uint8Array(o),a=0;s.length>=2;){var c=parseInt(s.substring(0,2),16);s=s.substring(2,s.length),r[a++]=c}var u=new Paho.MQTT.Message(r);u.qos=i.payloadMessage.qos,u.destinationName=i.payloadMessage.destinationName,i.payloadMessage.duplicate&&(u.duplicate=!0),i.payloadMessage.retained&&(u.retained=!0),n.payloadMessage=u;break;default:throw Error(p(_.INVALID_STORED_DATA,[e,t]))}0==e.indexOf("Sent:"+this._localKey)?(n.payloadMessage.duplicate=!0,this._sentMessages[n.messageIdentifier]=n):0==e.indexOf("Received:"+this._localKey)&&(this._receivedMessages[n.messageIdentifier]=n)},b.prototype._process_queue=function(){for(var e=null,t=this._msg_queue.reverse();e=t.pop();)this._socket_send(e),this._notify_msg_sent[e]&&(this._notify_msg_sent[e](),delete this._notify_msg_sent[e])},b.prototype._requires_ack=function(e){var t=Object.keys(this._sentMessages).length;if(t>this.maxMessageIdentifier)throw Error("Too many messages:"+t);for(;void 0!==this._sentMessages[this._message_identifier];)this._message_identifier++;e.messageIdentifier=this._message_identifier,this._sentMessages[e.messageIdentifier]=e,e.type===h.PUBLISH&&this.store("Sent:",e),this._message_identifier===this.maxMessageIdentifier&&(this._message_identifier=1)},b.prototype._on_socket_open=function(){var e=new v(h.CONNECT,this.connectOptions);e.clientId=this.clientId,this._socket_send(e)},b.prototype._on_socket_message=function(e){this._trace("Client._on_socket_message",e.data),this.receivePinger.reset();for(var t=this._deframeMessages(e.data),i=0;i<t.length;i+=1)this._handleMessage(t[i])},b.prototype._deframeMessages=function(e){var i=new Uint8Array(e);if(this.receiveBuffer){var n=new Uint8Array(this.receiveBuffer.length+i.length);n.set(this.receiveBuffer),n.set(i,this.receiveBuffer.length),i=n,delete this.receiveBuffer}try{for(var s=0,o=[];s<i.length;){var r=t(i,s),a=r[0];if(s=r[1],null===a)break;o.push(a)}s<i.length&&(this.receiveBuffer=i.subarray(s))}catch(c){return void this._disconnected(_.INTERNAL_ERROR.code,p(_.INTERNAL_ERROR,[c.message,c.stack.toString()]))}return o},b.prototype._handleMessage=function(e){this._trace("Client._handleMessage",e);try{switch(e.type){case h.CONNACK:if(this._connectTimeout.cancel(),this.connectOptions.cleanSession){for(var t in this._sentMessages){var i=this._sentMessages[t];localStorage.removeItem("Sent:"+this._localKey+i.messageIdentifier)}this._sentMessages={};for(var t in this._receivedMessages){var n=this._receivedMessages[t];localStorage.removeItem("Received:"+this._localKey+n.messageIdentifier)}this._receivedMessages={}}if(0!==e.returnCode){this._disconnected(_.CONNACK_RETURNCODE.code,p(_.CONNACK_RETURNCODE,[e.returnCode,f[e.returnCode]]));break}this.connected=!0,this.connectOptions.uris&&(this.hostIndex=this.connectOptions.uris.length);var s=new Array;for(var o in this._sentMessages)this._sentMessages.hasOwnProperty(o)&&s.push(this._sentMessages[o]);for(var s=s.sort(function(e,t){return e.sequence-t.sequence}),r=0,a=s.length;a>r;r++){var i=s[r];if(i.type==h.PUBLISH&&i.pubRecReceived){var c=new v(h.PUBREL,{messageIdentifier:i.messageIdentifier});this._schedule_message(c)}else this._schedule_message(i)}this.connectOptions.onSuccess&&this.connectOptions.onSuccess({invocationContext:this.connectOptions.invocationContext}),this._process_queue();break;case h.PUBLISH:this._receivePublish(e);break;case h.PUBACK:var i=this._sentMessages[e.messageIdentifier];i&&(delete this._sentMessages[e.messageIdentifier],localStorage.removeItem("Sent:"+this._localKey+e.messageIdentifier),this.onMessageDelivered&&this.onMessageDelivered(i.payloadMessage));break;case h.PUBREC:var i=this._sentMessages[e.messageIdentifier];if(i){i.pubRecReceived=!0;var c=new v(h.PUBREL,{messageIdentifier:e.messageIdentifier});this.store("Sent:",i),this._schedule_message(c)}break;case h.PUBREL:var n=this._receivedMessages[e.messageIdentifier];localStorage.removeItem("Received:"+this._localKey+e.messageIdentifier),n&&(this._receiveMessage(n),delete this._receivedMessages[e.messageIdentifier]);var u=new v(h.PUBCOMP,{messageIdentifier:e.messageIdentifier});this._schedule_message(u);break;case h.PUBCOMP:var i=this._sentMessages[e.messageIdentifier];delete this._sentMessages[e.messageIdentifier],localStorage.removeItem("Sent:"+this._localKey+e.messageIdentifier),this.onMessageDelivered&&this.onMessageDelivered(i.payloadMessage);break;case h.SUBACK:var i=this._sentMessages[e.messageIdentifier];i&&(i.timeOut&&i.timeOut.cancel(),e.returnCode.indexOf=Array.prototype.indexOf,-1!==e.returnCode.indexOf(128)?i.onFailure&&i.onFailure(e.returnCode):i.onSuccess&&i.onSuccess(e.returnCode),delete this._sentMessages[e.messageIdentifier]);break;case h.UNSUBACK:var i=this._sentMessages[e.messageIdentifier];i&&(i.timeOut&&i.timeOut.cancel(),i.callback&&i.callback(),delete this._sentMessages[e.messageIdentifier]);break;case h.PINGRESP:this.sendPinger.reset();break;case h.DISCONNECT:this._disconnected(_.INVALID_MQTT_MESSAGE_TYPE.code,p(_.INVALID_MQTT_MESSAGE_TYPE,[e.type]));break;default:this._disconnected(_.INVALID_MQTT_MESSAGE_TYPE.code,p(_.INVALID_MQTT_MESSAGE_TYPE,[e.type]))}}catch(l){return void this._disconnected(_.INTERNAL_ERROR.code,p(_.INTERNAL_ERROR,[l.message,l.stack.toString()]))}},b.prototype._on_socket_error=function(e){this._disconnected(_.SOCKET_ERROR.code,p(_.SOCKET_ERROR,[e.data]))},b.prototype._on_socket_close=function(){this._disconnected(_.SOCKET_CLOSE.code,p(_.SOCKET_CLOSE))},b.prototype._socket_send=function(e){if(1==e.type){var t=this._traceMask(e,"password");this._trace("Client._socket_send",t)}else this._trace("Client._socket_send",e);this.socket.send(e.encode()),this.sendPinger.reset()},b.prototype._receivePublish=function(e){switch(e.payloadMessage.qos){case"undefined":case 0:this._receiveMessage(e);break;case 1:var t=new v(h.PUBACK,{messageIdentifier:e.messageIdentifier});this._schedule_message(t),this._receiveMessage(e);break;case 2:this._receivedMessages[e.messageIdentifier]=e,this.store("Received:",e);var i=new v(h.PUBREC,{messageIdentifier:e.messageIdentifier});this._schedule_message(i);break;default:throw Error("Invaild qos="+wireMmessage.payloadMessage.qos)}},b.prototype._receiveMessage=function(e){this.onMessageArrived&&this.onMessageArrived(e.payloadMessage)},b.prototype._disconnected=function(e,t){this._trace("Client._disconnected",e,t),this.sendPinger.cancel(),this.receivePinger.cancel(),this._connectTimeout&&this._connectTimeout.cancel(),this._msg_queue=[],this._notify_msg_sent={},this.socket&&(this.socket.onopen=null,this.socket.onmessage=null,this.socket.onerror=null,this.socket.onclose=null,1===this.socket.readyState&&this.socket.close(),delete this.socket),this.connectOptions.uris&&this.hostIndex<this.connectOptions.uris.length-1?(this.hostIndex++,this._doConnect(this.connectOptions.uris[this.hostIndex])):(void 0===e&&(e=_.OK.code,t=p(_.OK)),this.connected?(this.connected=!1,this.onConnectionLost&&this.onConnectionLost({errorCode:e,errorMessage:t})):4===this.connectOptions.mqttVersion&&this.connectOptions.mqttVersionExplicit===!1?(this._trace("Failed to connect V4, dropping back to V3"),this.connectOptions.mqttVersion=3,this.connectOptions.uris?(this.hostIndex=0,this._doConnect(this.connectOptions.uris[0])):this._doConnect(this.uri)):this.connectOptions.onFailure&&this.connectOptions.onFailure({invocationContext:this.connectOptions.invocationContext,errorCode:e,errorMessage:t}))},b.prototype._trace=function(){if(this.traceFunction){for(var e in arguments)"undefined"!=typeof arguments[e]&&(arguments[e]=JSON.stringify(arguments[e]));var t=Array.prototype.slice.call(arguments).join("");this.traceFunction({severity:"Debug",message:t})}if(null!==this._traceBuffer)for(var e=0,i=arguments.length;i>e;e++)this._traceBuffer.length==this._MAX_TRACE_ENTRIES&&this._traceBuffer.shift(),this._traceBuffer.push(0===e?arguments[e]:"undefined"==typeof arguments[e]?arguments[e]:"  "+JSON.stringify(arguments[e]))},b.prototype._traceMask=function(e,t){var i={};for(var n in e)e.hasOwnProperty(n)&&(i[n]=n==t?"******":e[n]);return i};var S=function(e,t,i,n){var s;if("string"!=typeof e)throw new Error(p(_.INVALID_TYPE,[typeof e,"host"]));if(2==arguments.length){n=t,s=e;var o=s.match(/^(wss?):\/\/((\[(.+)\])|([^\/]+?))(:(\d+))?(\/.*)$/);if(!o)throw new Error(p(_.INVALID_ARGUMENT,[e,"host"]));e=o[4]||o[2],t=parseInt(o[7]),i=o[8]}else{if(3==arguments.length&&(n=i,i="/mqtt"),"number"!=typeof t||0>t)throw new Error(p(_.INVALID_TYPE,[typeof t,"port"]));if("string"!=typeof i)throw new Error(p(_.INVALID_TYPE,[typeof i,"path"]));var r=-1!=e.indexOf(":")&&"["!=e.slice(0,1)&&"]"!=e.slice(-1);s="ws://"+(r?"["+e+"]":e)+":"+t+i}for(var a=0,c=0;c<n.length;c++){var u=n.charCodeAt(c);u>=55296&&56319>=u&&c++,a++}if("string"!=typeof n||a>65535)throw new Error(p(_.INVALID_ARGUMENT,[n,"clientId"]));var h=new b(s,e,t,i,n);this._getHost=function(){return e},this._setHost=function(){throw new Error(p(_.UNSUPPORTED_OPERATION))},this._getPort=function(){return t},this._setPort=function(){throw new Error(p(_.UNSUPPORTED_OPERATION))},this._getPath=function(){return i},this._setPath=function(){throw new Error(p(_.UNSUPPORTED_OPERATION))},this._getURI=function(){return s},this._setURI=function(){throw new Error(p(_.UNSUPPORTED_OPERATION))},this._getClientId=function(){return h.clientId},this._setClientId=function(){throw new Error(p(_.UNSUPPORTED_OPERATION))},this._getOnConnectionLost=function(){return h.onConnectionLost},this._setOnConnectionLost=function(e){if("function"!=typeof e)throw new Error(p(_.INVALID_TYPE,[typeof e,"onConnectionLost"]));h.onConnectionLost=e},this._getOnMessageDelivered=function(){return h.onMessageDelivered},this._setOnMessageDelivered=function(e){if("function"!=typeof e)throw new Error(p(_.INVALID_TYPE,[typeof e,"onMessageDelivered"]));h.onMessageDelivered=e},this._getOnMessageArrived=function(){return h.onMessageArrived},this._setOnMessageArrived=function(e){if("function"!=typeof e)throw new Error(p(_.INVALID_TYPE,[typeof e,"onMessageArrived"]));h.onMessageArrived=e},this._getTrace=function(){return h.traceFunction},this._setTrace=function(e){if("function"!=typeof e)throw new Error(p(_.INVALID_TYPE,[typeof e,"onTrace"]));h.traceFunction=e},this.connect=function(e){if(e=e||{},l(e,{timeout:"number",userName:"string",password:"string",willMessage:"object",keepAliveInterval:"number",cleanSession:"boolean",useSSL:"boolean",invocationContext:"object",onSuccess:"function",onFailure:"function",hosts:"object",ports:"object",mqttVersion:"number"}),void 0===e.keepAliveInterval&&(e.keepAliveInterval=60),e.mqttVersion>4||e.mqttVersion<3)throw new Error(p(_.INVALID_ARGUMENT,[e.mqttVersion,"connectOptions.mqttVersion"]));if(void 0===e.mqttVersion?(e.mqttVersionExplicit=!1,e.mqttVersion=4):e.mqttVersionExplicit=!0,void 0===e.password&&void 0!==e.userName)throw new Error(p(_.INVALID_ARGUMENT,[e.password,"connectOptions.password"]));if(e.willMessage){if(!(e.willMessage instanceof I))throw new Error(p(_.INVALID_TYPE,[e.willMessage,"connectOptions.willMessage"]));if(e.willMessage.stringPayload,"undefined"==typeof e.willMessage.destinationName)throw new Error(p(_.INVALID_TYPE,[typeof e.willMessage.destinationName,"connectOptions.willMessage.destinationName"]))}if("undefined"==typeof e.cleanSession&&(e.cleanSession=!0),e.hosts){if(!(e.hosts instanceof Array))throw new Error(p(_.INVALID_ARGUMENT,[e.hosts,"connectOptions.hosts"]));if(e.hosts.length<1)throw new Error(p(_.INVALID_ARGUMENT,[e.hosts,"connectOptions.hosts"]));for(var t=!1,n=0;n<e.hosts.length;n++){if("string"!=typeof e.hosts[n])throw new Error(p(_.INVALID_TYPE,[typeof e.hosts[n],"connectOptions.hosts["+n+"]"]));if(/^(wss?):\/\/((\[(.+)\])|([^\/]+?))(:(\d+))?(\/.*)$/.test(e.hosts[n])){if(0==n)t=!0;else if(!t)throw new Error(p(_.INVALID_ARGUMENT,[e.hosts[n],"connectOptions.hosts["+n+"]"]))}else if(t)throw new Error(p(_.INVALID_ARGUMENT,[e.hosts[n],"connectOptions.hosts["+n+"]"]))}if(t)e.uris=e.hosts;else{if(!e.ports)throw new Error(p(_.INVALID_ARGUMENT,[e.ports,"connectOptions.ports"]));if(!(e.ports instanceof Array))throw new Error(p(_.INVALID_ARGUMENT,[e.ports,"connectOptions.ports"]));if(e.hosts.length!=e.ports.length)throw new Error(p(_.INVALID_ARGUMENT,[e.ports,"connectOptions.ports"]));e.uris=[];for(var n=0;n<e.hosts.length;n++){if("number"!=typeof e.ports[n]||e.ports[n]<0)throw new Error(p(_.INVALID_TYPE,[typeof e.ports[n],"connectOptions.ports["+n+"]"]));var o=e.hosts[n],r=e.ports[n],a=-1!=o.indexOf(":");s="ws://"+(a?"["+o+"]":o)+":"+r+i,e.uris.push(s)}}}h.connect(e)},this.subscribe=function(e,t){if("string"!=typeof e)throw new Error("Invalid argument:"+e);if(t=t||{},l(t,{qos:"number",invocationContext:"object",onSuccess:"function",onFailure:"function",timeout:"number"}),t.timeout&&!t.onFailure)throw new Error("subscribeOptions.timeout specified with no onFailure callback.");if("undefined"!=typeof t.qos&&0!==t.qos&&1!==t.qos&&2!==t.qos)throw new Error(p(_.INVALID_ARGUMENT,[t.qos,"subscribeOptions.qos"]));h.subscribe(e,t)},this.unsubscribe=function(e,t){if("string"!=typeof e)throw new Error("Invalid argument:"+e);if(t=t||{},l(t,{invocationContext:"object",onSuccess:"function",onFailure:"function",timeout:"number"}),t.timeout&&!t.onFailure)throw new Error("unsubscribeOptions.timeout specified with no onFailure callback.");h.unsubscribe(e,t)},this.send=function(e,t,i,n){var s;if(0==arguments.length)throw new Error("Invalid argument.length");if(1==arguments.length){if(!(e instanceof I)&&"string"!=typeof e)throw new Error("Invalid argument:"+typeof e);if(s=e,"undefined"==typeof s.destinationName)throw new Error(p(_.INVALID_ARGUMENT,[s.destinationName,"Message.destinationName"]));h.send(s)}else s=new I(t),s.destinationName=e,arguments.length>=3&&(s.qos=i),arguments.length>=4&&(s.retained=n),h.send(s)},this.disconnect=function(){h.disconnect()},this.getTraceLog=function(){return h.getTraceLog()},this.startTrace=function(){h.startTrace()},this.stopTrace=function(){h.stopTrace()},this.isConnected=function(){return h.connected}};S.prototype={get host(){return this._getHost()},set host(e){this._setHost(e)},get port(){return this._getPort()},set port(e){this._setPort(e)},get path(){return this._getPath()},set path(e){this._setPath(e)},get clientId(){return this._getClientId()},set clientId(e){this._setClientId(e)},get onConnectionLost(){return this._getOnConnectionLost()},set onConnectionLost(e){this._setOnConnectionLost(e)},get onMessageDelivered(){return this._getOnMessageDelivered()},set onMessageDelivered(e){this._setOnMessageDelivered(e)},get onMessageArrived(){return this._getOnMessageArrived()},set onMessageArrived(e){this._setOnMessageArrived(e)},get trace(){return this._getTrace()},set trace(e){this._setTrace(e)}};var I=function(e){var t;if(!("string"==typeof e||e instanceof ArrayBuffer||e instanceof Int8Array||e instanceof Uint8Array||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array))throw p(_.INVALID_ARGUMENT,[e,"newPayload"]);t=e,this._getPayloadString=function(){return"string"==typeof t?t:c(t,0,t.length)},this._getPayloadBytes=function(){if("string"==typeof t){var e=new ArrayBuffer(r(t)),i=new Uint8Array(e);return a(t,i,0),i}return t};var i=void 0;this._getDestinationName=function(){return i},this._setDestinationName=function(e){if("string"!=typeof e)throw new Error(p(_.INVALID_ARGUMENT,[e,"newDestinationName"]));i=e};var n=0;this._getQos=function(){return n},this._setQos=function(e){if(0!==e&&1!==e&&2!==e)throw new Error("Invalid argument:"+e);n=e};var s=!1;this._getRetained=function(){return s},this._setRetained=function(e){if("boolean"!=typeof e)throw new Error(p(_.INVALID_ARGUMENT,[e,"newRetained"]));s=e};var o=!1;this._getDuplicate=function(){return o},this._setDuplicate=function(e){o=e}};return I.prototype={get payloadString(){return this._getPayloadString()},get payloadBytes(){return this._getPayloadBytes()},get destinationName(){return this._getDestinationName()},set destinationName(e){this._setDestinationName(e)},get qos(){return this._getQos()},set qos(e){this._setQos(e)},get retained(){return this._getRetained()},set retained(e){this._setRetained(e)},get duplicate(){return this._getDuplicate()},set duplicate(e){this._setDuplicate(e)}},{Client:S,Message:I}}(window);var webduino=webduino||{};"undefined"!=typeof exports&&(module.exports=webduino),+function(e){"undefined"==typeof exports?e(webduino||{}):module.exports=e}(function(e){"use strict";function t(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function i(e){return"function"==typeof e}function n(e){return"number"==typeof e}function s(e){return"object"==typeof e&&null!==e}function o(e){return void 0===e}var r;r=t.prototype,r._events=void 0,r._maxListeners=void 0,t.defaultMaxListeners=10,r.setMaxListeners=function(e){if(!n(e)||0>e||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},r.emit=function(e){var t,n,r,a,c;if(this._events||(this._events={}),t=this._events[e],o(t))return!1;if(i(t))switch(arguments.length){case 1:t.call(this);break;case 2:t.call(this,arguments[1]);break;case 3:t.call(this,arguments[1],arguments[2]);break;default:r=Array.prototype.slice.call(arguments,1),t.apply(this,r)}else if(s(t))for(r=Array.prototype.slice.call(arguments,1),c=t.slice(),n=c.length,a=0;n>a;a++)c[a].apply(this,r);return!0},r.addListener=function(e,n){var r;if(!i(n))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,i(n.listener)?n.listener:n),this._events[e]?s(this._events[e])?this._events[e].push(n):this._events[e]=[this._events[e],n]:this._events[e]=n,s(this._events[e])&&!this._events[e].warned&&(r=o(this._maxListeners)?t.defaultMaxListeners:this._maxListeners,r&&r>0&&this._events[e].length>r&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace())),this},r.on=r.addListener,r.once=function(e,t){function n(){this.removeListener(e,n),s||(s=!0,
t.apply(this,arguments))}if(!i(t))throw TypeError("listener must be a function");var s=!1;return n.listener=t,this.on(e,n),this},r.removeListener=function(e,t){var n,o,r,a;if(!i(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(n=this._events[e],r=n.length,o=-1,n===t||i(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(s(n)){for(a=r;a-->0;)if(n[a]===t||n[a].listener&&n[a].listener===t){o=a;break}if(0>o)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(o,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},r.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[e],i(n))this.removeListener(e,n);else if(n)for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},r.listeners=function(e){var t;return t=this._events&&this._events[e]?i(this._events[e])?[this._events[e]]:this._events[e].slice():[]},t.listenerCount=function(e,t){var n;return n=e._events&&e._events[t]?i(e._events[t])?1:e._events[t].length:0},e.EventEmitter=t}),+function(e){"undefined"==typeof exports?e(webduino||{}):module.exports=e}(function(e){"use strict";function t(e){return"function"==typeof e}function i(e){return"[object Object]"===a.call(e)}function n(e){return i(e)&&e.constructor===Object&&!e.nodeType&&!e.setInterval}function s(e){return"[object Array]"===a.call(e)}function o(){var e,i,r,a,c,u,h=arguments[0]||{},l=1,d=arguments.length,_=!1;for("boolean"==typeof h&&(_=h,h=arguments[1]||{},l=2),"object"==typeof h||t(h)||(h={});d>l;l++)if(e=arguments[l],null!==e){"string"==typeof e&&(e=e.split(""));for(i in e)r=h[i],a=e[i],h!==a&&(_&&a&&(n(a)||(c=s(a)))?(c?(c=!1,u=r&&s(r)?r:[]):u=r&&n(r)?r:{},h[i]=o(_,u,a)):"undefined"!=typeof a&&(h[i]=a))}return h}var r=Object.prototype,a=(r.hasOwnProperty,r.toString);e.util={isFn:t,isFunction:t,isObject:i,isHash:n,isArray:s,extend:o}}),+function(e){"undefined"==typeof exports?e(webduino||{}):module.exports=e}(function(e){"use strict";function t(e,t,i){this.resolve=e,this.reject=t,this.custom=i}function i(e,t,i){if("function"==typeof e.custom){var n=function(){return e.custom.apply(n,arguments)};n.resolve=e.resolve,n.reject=e.reject,n.call(null,t,i)}else{if(t)return e.reject(t);e.resolve(i)}}function n(e,n){return function(){var s=this,o=Array.prototype.slice.call(arguments);return new Promise(function(r,a){var c=new t(r,a,n);o.push(i.bind(null,c)),e.apply(s,o)})}}e.util.promisify=n}),+function(e){"undefined"==typeof exports?e(webduino||{}):module.exports=e}(function(e){"use strict";function t(e){n.call(this)}var i,n=e.EventEmitter,s={OPEN:"open",READY:"ready",MESSAGE:"message",ERROR:"error",CLOSE:"close"};t.prototype=i=Object.create(n.prototype,{constructor:{value:t}}),i.send=function(e){throw new Error("error: direct call on abstract method.")},i.close=function(){throw new Error("error: direct call on abstract method.")},e.TransportEvent=s,e.Transport=t,e.transport=e.transport||{}}),+function(e){"undefined"==typeof exports?e(webduino||{}):module.exports=e}(function(e){"use strict";function t(e){l.call(this,e),this._options=e,this._clientId="_"+(new Date).getTime(),this._client=null,this._timer=null,this._reconnTime=0,this._status="",this._buf=[],this._isReady=!1,this._connHandler=n.bind(this),this._messageHandler=s.bind(this),this._disconnHandler=r.bind(this),this._errorHandler=a.bind(this),i(this)}function i(e){e._client=new Paho.MQTT.Client(e._options.url,e._clientId),e._client.onMessageArrived=e._messageHandler,e._client.onConnectionLost=e._disconnHandler,e._client.connect({userName:e._options.login||"",password:e._options.password||"",timeout:t.CONNECT_TIMEOUT,keepAliveInterval:t.KEEPALIVE_INTERVAL,onSuccess:e._connHandler,onFailure:e._errorHandler})}function n(){u(this),this._isReady=!0,this._reconnTime=0,this.emit(d.OPEN),this._client.subscribe(this._options.device+f.PONG),this._client.subscribe(this._options.device+f.STATUS)}function s(e){var t=e.destinationName,i=this._status;switch(t.substr(t.lastIndexOf("/")+1)){case"STATUS":this._status=e.payloadString,o(this,this._status,i);break;default:this.emit(d.MESSAGE,e.payloadBytes)}}function o(e,t,i){t!==i&&(t===_.OK?e.emit(d.READY):e.emit(d.ERROR,new Error("error: board connection failed. (1)")))}function r(e){this.emit(d.ERROR,new Error(e.errorCode?e.errorMessage:"error: board connection failed. (2)")),this._isReady&&(this._isReady=!1,this.emit(d.CLOSE),c(this))}function a(e){this.emit(d.ERROR,new Error(e.errorMessage)),this._isReady||c(this)}function c(e){u(e),e.close(),e._timer=setTimeout(function(){e._reconnTime+=1e3*t.RECONNECT_PERIOD,e._reconnTime<1e3*t.CONNECT_TIMEOUT&&i(e)},1e3*t.RECONNECT_PERIOD)}function u(e){e._timer&&(clearTimeout(e._timer),delete e._timer)}var h,l=e.Transport,d=e.TransportEvent,_={OK:"OK"},f={PING:"/PING",PONG:"/PONG",STATUS:"/STATUS"};t.prototype=h=Object.create(l.prototype,{constructor:{value:t},isReady:{get:function(){return this._isReady}}}),h.send=function(e){this._buf=new Uint8Array(e.length?e:[e]),e=new Paho.MQTT.Message(this._buf),e.destinationName=this._options.device+f.PING,e.qos=0,this._client.send(e)},h.close=function(){this._isReady&&this._client.disconnect(),delete this._client},t.RECONNECT_PERIOD=5,t.KEEPALIVE_INTERVAL=30,t.CONNECT_TIMEOUT=60,e.transport.mqtt=t}),+function(e){"undefined"==typeof exports?e(webduino||{}):module.exports=e}(function(e){"use strict";function t(e,t){n.call(this),this._type=t,this._capabilities={},this._number=e,this._analogNumber=void 0,this._analogWriteResolution=255,this._analogReadResolution=1023,this._value=0,this._lastValue=-1,this._preFilterValue=0,this._average=0,this._minimum=Math.pow(2,16),this._maximum=0,this._sum=0,this._numSamples=0,this._filters=null,this._generator=null,this._state=void 0,this._autoSetValueCallback=this.autoSetValue.bind(this)}var i,n=e.EventEmitter,s={CHANGE:"change",RISING_EDGE:"risingEdge",FALLING_EDGE:"fallingEdge"};t.prototype=i=Object.create(n.prototype,{constructor:{value:t},capabilities:{get:function(){return this._capabilities}},analogNumber:{get:function(){return this._analogNumber}},number:{get:function(){return this._number}},analogWriteResolution:{get:function(){return this._analogWriteResolution}},analogReadResolution:{get:function(){return this._analogReadResolution}},state:{get:function(){return this._state}},average:{get:function(){return this._average}},minimum:{get:function(){return this._minimum}},maximum:{get:function(){return this._maximum}},value:{get:function(){return this._value},set:function(e){this._lastValue=this._value,this._preFilterValue=e,this._value=this.applyFilters(e),this.calculateMinMaxAndMean(this._value),this.detectChange(this._lastValue,this._value)}},lastValue:{get:function(){return this._lastValue}},preFilterValue:{get:function(){return this._preFilterValue}},filters:{get:function(){return this._filters},set:function(e){this._filters=e}},generator:{get:function(){return this._generator}}}),i.setAnalogNumber=function(e){this._analogNumber=e},i.setAnalogWriteResolution=function(e){this._analogWriteResolution=e},i.setAnalogReadResolution=function(e){this._analogReadResolution=e},i.setState=function(e){this._type===t.PWM&&(e/=this._analogWriteResolution),this._state=e},i.setType=function(e){e>=0&&e<t.TOTAL_PIN_MODES&&(this._type=e)},i.setCapabilities=function(e){this._capabilities=e;var i=this._capabilities[t.PWM],n=this._capabilities[t.AIN];i&&(this._analogWriteResolution=Math.pow(2,i)-1),n&&(this._analogReadResolution=Math.pow(2,n)-1)},i.detectChange=function(e,t){e!==t&&(this.emit(s.CHANGE,this),0>=e&&0!==t?this.emit(s.RISING_EDGE,this):0!==e&&0>=t&&this.emit(s.FALLING_EDGE,this))},i.clearWeight=function(){this._sum=this._average,this._numSamples=1},i.calculateMinMaxAndMean=function(e){var t=Number.MAX_VALUE;this._minimum=Math.min(e,this._minimum),this._maximum=Math.max(e,this._maximum),this._sum+=e,this._average=this._sum/++this._numSamples,this._numSamples>=t&&this.clearWeight()},i.clear=function(){this._minimum=this._maximum=this._average=this._lastValue=this._preFilterValue,this.clearWeight()},i.addFilter=function(e){null!==e&&(null===this._filters&&(this._filters=[]),this._filters.push(e))},i.removeFilter=function(e){var t;this._filters.length<1||(t=this._filters.indexOf(e),-1!==t&&this._filters.splice(t,1))},i.addGenerator=function(e){this.removeGenerator(),this._generator=e,this._generator.on("update",this._autoSetValueCallback)},i.removeGenerator=function(){null!==this._generator&&this._generator.removeListener("update",this._autoSetValueCallback),delete this._generator},i.removeAllFilters=function(){delete this._filters},i.autoSetValue=function(e){this.value=e},i.applyFilters=function(e){var t;if(null===this._filters)return e;t=e;for(var i=this._filters.length,n=0;i>n;n++)t=this._filters[n].processSample(t);return t},t.HIGH=1,t.LOW=0,t.ON=1,t.OFF=0,t.DIN=0,t.DOUT=1,t.AIN=2,t.AOUT=3,t.PWM=3,t.SERVO=4,t.SHIFT=5,t.I2C=6,t.ONEWIRE=7,t.STEPPER=8,t.TOTAL_PIN_MODES=9,e.PinEvent=s,e.Pin=t}),+function(e){"undefined"==typeof exports?e(webduino||{}):module.exports=e}(function(e){"use strict";function t(){i.call(this)}var i=e.EventEmitter;t.prototype=Object.create(i.prototype,{constructor:{value:t},type:{get:function(){return this._type}}}),e.Module=t,e.module=e.module||{}}),+function(e){"undefined"==typeof exports?e(webduino||{}):module.exports=e}(function(e){"use strict";function t(e){u.call(this),this._options=e,this._buf=[],this._digitalPort=[],this._numPorts=0,this._analogPinMapping=[],this._digitalPinMapping=[],this._i2cPins=[],this._ioPins=[],this._totalPins=0,this._totalAnalogPins=0,this._samplingInterval=19,this._isReady=!1,this._firmwareName="",this._firmwareVersion=0,this._capabilityQueryResponseReceived=!1,this._numPinStateRequests=0,this._transport=null,this._pinStateEventCenter=new u,this._initialVersionResultHandler=i.bind(this),this._sendOutHandler=n.bind(this),this._readyHandler=s.bind(this),this._messageHandler=o.bind(this),this._errorHandler=r.bind(this),this.setTransport(this._options.transport||0)}function i(e){{var t=10*e.version;e.name}if(!(t>=23))throw new Error("error: You must upload StandardFirmata version 2.3 or greater from Arduino version 1.0 or higher");this.queryCapabilities()}function n(e){var t=e._type,i=e.number,n=e.value;switch(t){case _.DOUT:this.sendDigitalData(i,n);break;case _.AOUT:this.sendAnalogData(i,n);break;case _.SERVO:this.sendServoData(i,n)}}function s(){this.begin()}function o(e){var t=e.length;if(t)for(var i=0;t>i;i++)this.processInput(e[i]);else this.processInput(e)}function r(e){this._isReady=!1,this.emit(p.ERROR,e)}function a(e){console&&console.log(e.stack||e)}var c,u=e.EventEmitter,h=e.TransportEvent,l=e.Transport,d=e.PinEvent,_=e.Pin,f=e.util,p={ANALOG_DATA:"analogData",DIGITAL_DATA:"digitalData",FIRMWARE_VERSION:"firmwareVersion",FIRMWARE_NAME:"firmwareName",STRING_MESSAGE:"stringMessage",SYSEX_MESSAGE:"sysexMessage",PIN_STATE_RESPONSE:"pinStateResponse",READY:"ready",ERROR:"error"},g=144,m=224,v=192,E=208,y=244,b=249,S=255,I=240,w=247,A=112,M=113,R=111,O=109,P=110,N=107,T=108,C=105,D=106,L=121,U=122,x=10,V=100;t.prototype=c=Object.create(u.prototype,{constructor:{value:t},samplingInterval:{get:function(){return this._samplingInterval},set:function(e){if(!(e>=x&&V>=e))throw new Error("warning: Sampling interval must be between "+x+" and "+V);this._samplingInterval=e,this.send([I,U,127&e,e>>7&127,w])}},isReady:{get:function(){return this._isReady}}}),c.begin=function(){this.once(p.FIRMWARE_NAME,this._initialVersionResultHandler),this.reportFirmware()},c.processInput=function(e){var t,i;e=parseInt(e,10),this._buf.push(e),t=this._buf.length,i=this._buf[0],i>=128&&i!==I?3===t&&(this.processMultiByteCommand(this._buf),this._buf=[]):i===I&&e===w?(this.processSysexCommand(this._buf),this._buf=[]):e>=128&&128>i&&(this._buf=[],e!==w&&this._buf.push(e))},c.processMultiByteCommand=function(e){var t,i=e[0];switch(240>i&&(i=240&i,t=15&e[0]),i){case g:this.processDigitalMessage(t,e[1],e[2]);break;case b:this._firmwareVersion=e[1]+e[2]/10,this.emit(p.FIRMWARE_VERSION,{version:this._firmwareVersion});break;case m:this.processAnalogMessage(t,e[1],e[2])}},c.processDigitalMessage=function(e,t,i){var n,s=8*e,o=s+8,r=t|i<<7,a={};o>=this._totalPins&&(o=this._totalPins);for(var c=0,u=s;o>u;u++){if(a=this.getDigitalPin(u),void 0===a)return;a._type===_.DIN&&(n=r>>c&1,n!==a.value&&(a.value=n,this.emit(p.DIGITAL_DATA,{pin:a}))),c++}},c.processAnalogMessage=function(e,t,i){var n=this.getAnalogPin(e);void 0!==n&&(n.value=this.getValueFromTwo7bitBytes(t,i)/n.analogReadResolution,n.value!==n.lastValue&&this.emit(p.ANALOG_DATA,{pin:n}))},c.processSysexCommand=function(e){e.shift(),e.pop();var t=e[0];switch(t){case L:this.processQueryFirmwareResult(e);break;case M:this.processSysExString(e);break;case T:this.processCapabilitiesResponse(e);break;case P:this.processPinStateResponse(e);break;case D:this.processAnalogMappingResponse(e);break;default:this.emit(p.SYSEX_MESSAGE,{message:e})}},c.processQueryFirmwareResult=function(e){for(var t,i=3,n=e.length;n>i;i+=2)t=e[i],t+=e[i+1],this._firmwareName+=String.fromCharCode(t);this._firmwareVersion=e[1]+e[2]/10,this.emit(p.FIRMWARE_NAME,{name:this._firmwareName,version:this._firmwareVersion})},c.processSysExString=function(e){for(var t,i="",n=e.length,s=1;n>s;s+=2)t=e[s],t+=e[s+1],i+=String.fromCharCode(t);this.emit(p.STRING_MESSAGE,{message:i})},c.processCapabilitiesResponse=function(e){var t,i,n={},s=1,o=0,r=0,a=e.length;for(this._capabilityQueryResponseReceived=!0;a>=s;)127===e[s]?(this._digitalPinMapping[o]=o,t=void 0,n[_.DOUT]&&(t=_.DOUT),n[_.AIN]&&(t=_.AIN,this._analogPinMapping[r++]=o),i=new _(o,t),i.setCapabilities(n),this.managePinListener(i),this._ioPins[o]=i,i._capabilities[_.I2C]&&this._i2cPins.push(i.number),n={},o++,s++):(n[e[s]]=e[s+1],s+=2);this._numPorts=Math.ceil(o/8);for(var c=0;c<this._numPorts;c++)this._digitalPort[c]=0;this._totalPins=o,this._totalAnalogPins=r,this.queryAnalogMapping()},c.processAnalogMappingResponse=function(e){for(var t=e.length,i=1;t>i;i++)127!==e[i]&&(this._analogPinMapping[e[i]]=i-1,this.getPin(i-1).setAnalogNumber(e[i]));this.startup()},c.startup=function(){this._isReady=!0,this.emit(p.READY)},c.systemReset=function(){this.send(S)},c.processPinStateResponse=function(e){if(!(this._numPinStateRequests<=0)){var t,i=e.length,n=e[1],s=e[2],o=this._ioPins[n];i>4?t=this.getValueFromTwo7bitBytes(e[3],e[4]):i>3&&(t=e[3]),o._type!==s&&(o.setType(s),this.managePinListener(o)),o.setState(t),this._numPinStateRequests--,this._numPinStateRequests<0&&(this._numPinStateRequests=0),this._pinStateEventCenter.emit(n,o),this.emit(p.PIN_STATE_RESPONSE,{pin:o})}},c.toDec=function(e){e=e.substring(0,1);var t=e.charCodeAt(0);return t},c.managePinListener=function(e){if(e._type===_.DOUT||e._type===_.AOUT||e._type===_.SERVO)u.listenerCount(e,d.CHANGE)||e.on(d.CHANGE,this._sendOutHandler);else if(u.listenerCount(e,d.CHANGE))try{e.removeListener(d.CHANGE,this._sendOutHandler)}catch(t){a("debug: caught pin removeEventListener exception")}},c.sendAnalogData=function(e,t){var i=this.getDigitalPin(e).analogWriteResolution;t*=i,t=0>t?0:t,t=t>i?i:t,e>15||t>Math.pow(2,14)?this.sendExtendedAnalogData(e,t):this.send([m|15&e,127&t,t>>7&127])},c.sendExtendedAnalogData=function(e,t){var i=[];if(t>Math.pow(2,16))throw new Error("error: Extended Analog values > 16 bits are not currently supported by StandardFirmata");i[0]=I,i[1]=R,i[2]=e,i[3]=127&t,i[4]=t>>7&127,t>=Math.pow(2,14)&&(i[5]=t>>14&127),i.push(w),this.send(i)},c.sendDigitalData=function(e,t){var i=Math.floor(e/8);if(t===_.HIGH)this._digitalPort[i]|=t<<e%8;else{if(t!==_.LOW)throw new Error("Invalid value passed to sendDigital, value must be 0 or 1.");this._digitalPort[i]&=~(1<<e%8)}this.sendDigitalPort(i,this._digitalPort[i])},c.sendServoData=function(e,t){var i=this.getDigitalPin(e);i._type===_.SERVO&&i.lastValue!==t&&this.sendAnalogData(e,t)},c.queryCapabilities=function(){this.send([I,N,w])},c.queryAnalogMapping=function(){this.send([I,C,w])},c.getValueFromTwo7bitBytes=function(e,t){return t<<7|e},c.getTransport=function(){return this._transport},c.setTransport=function(t){var i,n=e.transport[t];if(this._transport instanceof l){try{this._transport.close()}catch(s){}this._transport.removeAllListeners(),delete this._transport}n&&(i=new n(this._options))instanceof l&&(this._transport=i,i.on(h.READY,this._readyHandler),i.on(h.MESSAGE,this._messageHandler),i.on(h.ERROR,this._errorHandler))},c.reportVersion=function(){this.send(b)},c.reportFirmware=function(){this.send([I,L,w])},c.enableDigitalPins=function(){for(var e=0;e<this._numPorts;e++)this.sendDigitalPortReporting(e,_.ON)},c.disableDigitalPins=function(){for(var e=0;e<this._numPorts;e++)this.sendDigitalPortReporting(e,_.OFF)},c.sendDigitalPortReporting=function(e,t){this.send([E|e,t])},c.enableAnalogPin=function(e){this.sendAnalogPinReporting(e,_.ON)},c.disableAnalogPin=function(e){this.sendAnalogPinReporting(e,_.OFF)},c.sendAnalogPinReporting=function(e,t){this.send([v|e,t])},c.setDigitalPinMode=function(e,t,i){this.getDigitalPin(e).setType(t),this.managePinListener(this.getDigitalPin(e)),i&&i===!0||this.send([y,e,t])},c.setAnalogPinMode=function(e,t,i){this.getAnalogPin(e).setType(t),i&&i===!0||this.send([y,e,t])},c.enablePullUp=function(e){this.sendDigitalData(e,_.HIGH)},c.getFirmwareName=function(){return this._firmwareName},c.getFirmwareVersion=function(){return this._firmwareVersion},c.getPinCapabilities=function(){var e,t,i,n,s=[],o={0:"input",1:"output",2:"analog",3:"pwm",4:"servo",5:"shift",6:"i2c",7:"onewire",8:"stepper"};e=this._ioPins.length;for(var r=0;e>r;r++){t={},i=this._ioPins[r]._capabilities,n=!1;for(var a in i)i.hasOwnProperty(a)&&(n=!0,a>=0&&(t[o[a]]=this._ioPins[r]._capabilities[a]));s[r]=n?t:{"not available":"0"}}return s},c.queryPinState=function(e,t){var i=this,n=[],s=[];if(e=f.isArray(e)?e:[e],"function"==typeof t){var o=i._pinStateEventCenter.once.bind(i._pinStateEventCenter);e.forEach(function(e){n.push(f.promisify(o,function(e){this.resolve(e)})(e.number))}),Promise.all(n).then(function(e){t.call(i,e.length>1?e:e[0])})}e.forEach(function(e){s=s.concat([I,O,e.number,w]),i._numPinStateRequests++}),i.send(s)},c.sendDigitalPort=function(e,t){this.send([g|15&e,127&t,t>>7])},c.sendString=function(e){for(var t=[],i=0,n=e.length;n>i;i++)t.push(127&this.toDec(e[i])),t.push(this.toDec(e[i])>>7&127);this.sendSysex(M,t)},c.sendSysex=function(e,t){var i=[];i[0]=I,i[1]=e;for(var n=0,s=t.length;s>n;n++)i.push(t[n]);i.push(w),this.send(i)},c.sendServoAttach=function(e,t,i){var n,s=[];t=t||544,i=i||2400,s[0]=I,s[1]=A,s[2]=e,s[3]=t%128,s[4]=t>>7,s[5]=i%128,s[6]=i>>7,s[7]=w,this.send(s),n=this.getDigitalPin(e),n.setType(_.SERVO),this.managePinListener(n)},c.getPin=function(e){return this._ioPins[e]},c.getAnalogPin=function(e){return this._ioPins[this._analogPinMapping[e]]},c.getDigitalPin=function(e){return this._ioPins[this._digitalPinMapping[e]]},c.getPins=function(){return this._ioPins},c.analogToDigital=function(e){return this.getAnalogPin(e).number},c.getPinCount=function(){return this._totalPins},c.getAnalogPinCount=function(){return this._totalAnalogPins},c.getI2cPins=function(){return this._i2cPins},c.reportCapabilities=function(){for(var e,t=this.getPinCapabilities(),i=t.length,n=0;i>n;n++){a("Pin "+n+":");for(var s in t[n])t[n].hasOwnProperty(s)&&(e=t[n][s],a("	"+s+" ("+e+(e>1?" bits)":" bit)")))}},c.send=function(e){this._transport.send(e)},c.close=function(){this._transport.close()},e.BoardEvent=p,e.Board=t}),+function(e){"undefined"==typeof exports?e(webduino||{}):module.exports=e}(function(e){"use strict";function t(e){"string"==typeof e&&(e={device:e}),e=r.extend(r.extend({},i()),e),e.url=n(e.server)+"/",c.call(this,e)}function i(){return{transport:"mqtt",server:t.DEFAULT_SERVER,login:"admin",password:"password"}}function n(e){return 0===e.indexOf("ws://")||0===e.indexOf("wss://")?e:("undefined"!=typeof location&&"https:"===location.protocol?"wss://":"ws://")+e}function s(e,t){e._transport.emit(a.MESSAGE,t)}var o,r=e.util,a=e.TransportEvent,c=e.Board;t.prototype=o=Object.create(c.prototype,{constructor:{value:t}}),o.reportFirmware=function(){var e=[240,121,2,4,119,0,101,0,98,0,100,0,117,0,105,0,110,0,111,0,46,0,105,0,110,0,111,0,247];s(this,e)},o.queryCapabilities=function(){var e=[240,108,127,127,0,1,1,1,4,14,127,0,1,1,1,3,8,4,14,127,0,1,1,1,4,14,127,0,1,1,1,3,8,4,14,127,0,1,1,1,3,8,4,14,127,0,1,1,1,4,14,127,0,1,1,1,4,14,127,0,1,1,1,3,8,4,14,127,0,1,1,1,3,8,4,14,127,0,1,1,1,3,8,4,14,127,0,1,1,1,4,14,127,0,1,1,1,4,14,127,0,1,1,1,2,10,4,14,127,0,1,1,1,2,10,4,14,127,0,1,1,1,2,10,4,14,127,0,1,1,1,2,10,4,14,127,0,1,1,1,2,10,4,14,127,0,1,1,1,2,10,4,14,127,2,10,127,2,10,127,247];s(this,e)},o.queryAnalogMapping=function(){var e=[240,106,127,127,127,127,127,127,127,127,127,127,127,127,127,127,0,1,2,3,4,5,6,7,247];s(this,e)},o.startup=function(){var e=[144,0,0,145,0,0,146,0,0];c.prototype.startup.call(this),s(this,e)},t.DEFAULT_SERVER="wss://ws.webduino.io",e.WebArduino=t}),+function(e){"undefined"==typeof exports?e(webduino||{}):module.exports=e}(function(e){"use strict";function t(e,i,n){if(o.call(this),this._board=e,this._pin=i,this._driveMode=n||t.SOURCE_DRIVE,this._supportsPWM=void 0,this._driveMode===t.SOURCE_DRIVE)this._onValue=1,this._offValue=0;else{if(this._driveMode!==t.SYNC_DRIVE)throw new Error("error: driveMode should be Led.SOURCE_DRIVE or Led.SYNC_DRIVE");this._onValue=0,this._offValue=1}i.capabilities[s.PWM]?(e.setDigitalPinMode(i.number,s.PWM),this._supportsPWM=!0):(e.setDigitalPinMode(i.number,s.DOUT),this._supportsPWM=!1)}function i(e,t,i,n){e._board.queryPinState(t,function(t){t.state===i&&n.call(e)})}var n,s=e.Pin,o=e.Module;t.prototype=n=Object.create(o.prototype,{constructor:{value:t},intensity:{get:function(){return this._pin.value},set:function(e){this._supportsPWM||(e=.5>e?0:1),this._driveMode===t.SOURCE_DRIVE?this._pin.value=e:this._driveMode===t.SYNC_DRIVE&&(this._pin.value=1-e)}}}),n.on=function(e){this._pin.value=this._onValue,"function"==typeof e&&i(this,this._pin,this._pin.value,e)},n.off=function(e){this._pin.value=this._offValue,"function"==typeof e&&i(this,this._pin,this._pin.value,e)},n.toggle=function(e){this._pin.value=1-this._pin.value,"function"==typeof e&&i(this,this._pin,this._pin.value,e)},t.SOURCE_DRIVE=0,t.SYNC_DRIVE=1,e.module.Led=t}),+function(e){"undefined"==typeof exports?e(webduino||{}):module.exports=e}(function(e){"use strict";function t(e,i,n,s,o){c.call(this),void 0===o&&(o=t.COMMON_ANODE),this._board=e,this._redLed=new a(e,i,o),this._greenLed=new a(e,n,o),this._blueLed=new a(e,s,o),this.setColor(0,0,0)}function i(e){return parseInt(e.substring(0,2),16)}function n(e){return parseInt(e.substring(2,4),16)}function s(e){return parseInt(e.substring(4,6),16)}function o(e){return"#"==e.charAt(0)?e.substring(1,7):e}var r,a=e.module.Led,c=e.Module;t.prototype=r=Object.create(c.prototype,{constructor:{value:t}}),r.setColor=function(e,t,r,a){if("undefined"==typeof t||"function"==typeof t){var c=o(e);a=t,e=i(c),t=n(c),r=s(c)}if(e/=255,t/=255,r/=255,this._redLed.intensity=e,this._greenLed.intensity=t,this._blueLed.intensity=r,"function"==typeof a){var u=this,h=this._redLed._pin,l=this._greenLed._pin,d=this._blueLed._pin;this._board.queryPinState([h,l,d],function(e){e[0].state===h.value&&e[1].state===l.value&&e[2].state===d.value&&a.call(u)})}},t.COMMON_ANODE=a.SYNC_DRIVE,t.COMMON_CATHODE=a.SOURCE_DRIVE,e.module.RGBLed=t}),+function(e){"undefined"==typeof exports?e(webduino||{}):module.exports=e}(function(e){"use strict";function t(e,u,h,l){c.call(this),this._board=e,this._pin=u,this._repeatCount=0,this._timer=null,this._timeout=null,this._buttonMode=h||t.PULL_DOWN,this._sustainedPressInterval=l||1e3,this._debounceInterval=8,this._pressHandler=n.bind(this),this._releaseHandler=s.bind(this),this._sustainedPressHandler=o.bind(this),e.setDigitalPinMode(u.number,a.DIN),this._buttonMode===t.INTERNAL_PULL_UP?(e.enablePullUp(u.number),this._pin.value=a.HIGH):this._buttonMode===t.PULL_UP&&(this._pin.value=a.HIGH),this._pin.on(r.CHANGE,i.bind(this))}function i(e){var i,n=e.value;this._buttonMode===t.PULL_DOWN?i=1===n?this._pressHandler:this._releaseHandler:(this._buttonMode===t.PULL_UP||this._buttonMode===t.INTERNAL_PULL_UP)&&(i=1===n?this._releaseHandler:this._pressHandler),this._timeout&&clearTimeout(this._timeout),this._timeout=setTimeout(i,this._debounceInterval)}function n(){this.emit(u.PRESS),this._timer=setInterval(this._sustainedPressHandler,this._sustainedPressInterval)}function s(){this.emit(u.RELEASE),this._timer&&(clearInterval(this._timer),delete this._timer),this._repeatCount=0}function o(){this.emit(this._repeatCount>0?u.SUSTAINED_PRESS:u.LONG_PRESS),this._repeatCount++}var r=e.PinEvent,a=e.Pin,c=e.Module,u={PRESS:"pressed",RELEASE:"released",LONG_PRESS:"longPress",SUSTAINED_PRESS:"sustainedPress"};t.prototype=Object.create(c.prototype,{constructor:{value:t},buttonMode:{get:function(){return this._buttonMode}},sustainedPressInterval:{get:function(){return this._sustainedPressInterval},set:function(e){this._sustainedPressInterval=e}}}),t.PULL_DOWN=0,t.PULL_UP=1,t.INTERNAL_PULL_UP=2,e.module.ButtonEvent=u,e.module.Button=t}),+function(e){"undefined"==typeof exports?e(webduino||{}):module.exports=e}(function(e){"use strict";function t(e,t,n){o.call(this),this._type="HC-SR04",this._board=e,this._trigger=t,this._echo=n,this._lastRecv=null,this._pingTimer=null,this._pingCallback=function(){},this._messageHandler=i.bind(this)}function i(e){var t=e.message;t[0]===a&&n(this,t)}function n(e,t){var i,n,s="",o=3;if(t[1]===e._trigger.number&&t[2]===e._echo.number){for(;o<t.length;)i=t[o],n=t[o+1],s+=i-48,n&&(s+=n-48),o+=2;e._lastRecv=Date.now(),e.emit(u.PING,parseInt(s))}}var s,o=e.Module,r=e.BoardEvent,a=1,c=350,u={PING:"ping",PING_ERROR:"pingError"};t.prototype=s=Object.create(o.prototype,{constructor:{value:t}}),s.ping=function(e,t){var i,n=this;n.stopPing(),"function"==typeof e&&(n._board.once(r.ERROR,n.stopPing.bind(n)),n._pingCallback=function(t){e(t)},n._board.on(r.SYSEX_MESSAGE,n._messageHandler),n.on(u.PING,n._pingCallback),(i=function(){n._board.sendSysex(a,[n._trigger.number,n._echo.number]),t&&(t=Math.max(t,c),null===n._lastRecv||Date.now()-n._lastRecv<5*t?n._pingTimer=setTimeout(i,t):n.stopPing())})())},s.stopPing=function(){this.removeListener(u.PING,this._pingCallback),this._board.removeListener(r.SYSEX_MESSAGE,this._messageHandler),this._lastRecv=null,this._pingTimer&&(clearTimeout(this._pingTimer),delete this._pingTimer)},e.module.UltrasonicEvent=u,e.module.Ultrasonic=t}),+function(e){"undefined"==typeof exports?e(webduino||{}):module.exports=e}(function(e){"use strict";function t(e,t,s,o){n.call(this),this._type="SG90",this._board=e,this._pin=t,this._angle=void 0,this._minAngle=s||0,this._maxAngle=o||180,e.sendServoAttach(t.number),e.setDigitalPinMode(t.number,i.SERVO)}var i=e.Pin,n=e.Module;t.prototype=Object.create(n.prototype,{constructor:{value:t},angle:{get:function(){return this._pin._type===i.SERVO?this._angle:void 0},set:function(e){this._pin._type===i.SERVO&&(this._angle=e,this._pin.value=Math.max(0,Math.min(1,(this._angle-this._minAngle)/(this._maxAngle-this._minAngle)*t.COEF_TO_0_180)))}}}),t.COEF_TO_0_180=180/255,e.module.Servo=t}),+function(e){"undefined"==typeof exports?e(webduino||{}):module.exports=e}(function(e){"use strict";function t(e,t){o.call(this),this._board=e,this._pin=t,e.setDigitalPinMode(t.number,s.DIN),this._pin.value=s.HIGH,this._pin.on(n.CHANGE,i.bind(this))}function i(e){this.emit(e.value===s.HIGH?r.HIGH:r.LOW)}var n=e.PinEvent,s=e.Pin,o=e.Module,r={HIGH:"high",LOW:"low"};t.prototype=Object.create(o.prototype,{constructor:{value:t}}),e.module.TiltEvent=r,e.module.Tilt=t}),+function(e){"undefined"==typeof exports?e(webduino||{}):module.exports=e}(function(e){"use strict";function t(e,t){o.call(this),this._board=e,this._pin=t,e.setDigitalPinMode(t.number,s.DIN),this._pin.value=s.HIGH,this._pin.on(n.CHANGE,i.bind(this))}function i(e){this.emit(e.value===s.HIGH?r.DETECTED:r.ENDED)}var n=e.PinEvent,s=e.Pin,o=e.Module,r={DETECTED:"detected",ENDED:"ended"};t.prototype=Object.create(o.prototype,{constructor:{value:t}}),e.module.PirEvent=r,e.module.Pir=t}),+function(e){"undefined"==typeof exports?e(webduino||{}):module.exports=e}(function(e){"use strict";function t(e,t){o.call(this),this._board=e,this._pin=t,e.setDigitalPinMode(t.number,s.DIN),this._pin.value=s.HIGH,this._pin.on(n.CHANGE,i.bind(this))}function i(e){this.emit(e.value===s.HIGH?r.HIGH:r.LOW)}var n=e.PinEvent,s=e.Pin,o=e.Module,r={HIGH:"high",LOW:"low"};t.prototype=Object.create(o.prototype,{constructor:{value:t}}),e.module.ShockEvent=r,e.module.Shock=t}),+function(e){"undefined"==typeof exports?e(webduino||{}):module.exports=e}(function(e){"use strict";function t(e,t){o.call(this),this._type="FC_04",this._board=e,this._pin=t,e.setDigitalPinMode(t.number,s.DIN),this._pin.value=s.HIGH,this._pin.on(n.CHANGE,i.bind(this))}function i(e){this.emit(e.value===s.LOW?r.DETECTED:r.ENDED)}var n=e.PinEvent,s=e.Pin,o=e.Module,r={DETECTED:"detected",ENDED:"ended"};t.prototype=Object.create(o.prototype,{constructor:{value:t}}),e.module.SoundEvent=r,e.module.Sound=t}),+function(e){"undefined"==typeof exports?e(webduino||{}):module.exports=e}(function(e){"use strict";function t(e,t){o.call(this),this._type="KY-019",this._board=e,this._pin=t,this._onValue=1,this._offValue=0,e.setDigitalPinMode(t.number,s.DOUT),this.off()}function i(e,t,i,n){e._board.queryPinState(t,function(t){t.state===i&&n.call(e)})}var n,s=e.Pin,o=e.Module;t.prototype=n=Object.create(o.prototype,{constructor:{value:t}}),n.on=function(e){this._pin.value=this._onValue,"function"==typeof e&&i(this,this._pin,this._pin.value,e)},n.off=function(e){this._pin.value=this._offValue,"function"==typeof e&&i(this,this._pin,this._pin.value,e)},n.toggle=function(e){this._pin.value=1-this._pin.value,"function"==typeof e&&i(this,this._pin,this._pin.value,e)},e.module.Relay=t}),+function(e){"undefined"==typeof exports?e(webduino||{}):module.exports=e}(function(e){"use strict";function t(e,t){o.call(this),this._type="DHT11",this._board=e,this._pin=t,this._lastRecv=null,this._readTimer=null,this._readCallback=function(){},this._messageHandler=i.bind(this)}function i(e){var t=e.message;t[0]===a[0]&&t[1]===a[1]&&n(this,t)}function n(e,t){var i,n,s="",o=3,r=4,a=[];if(t[2]===e._pin.number){for(;o<t.length;)i=t[o],n=t[o+1],s+=i-48,n&&(s+=n-48),o+=2,(o-3)%r===0&&(a.push(parseInt(s)/100),s="");e._lastRecv=Date.now(),e.emit(u.READ,a[0],a[1])}}var s,o=e.Module,r=e.BoardEvent,a=[4,4],c=300,u={READ:"read",READ_ERROR:"readError"};t.prototype=s=Object.create(o.prototype,{constructor:{value:t}}),s.read=function(e,t){var i,n=this;n.stopRead(),"function"==typeof e&&(n._board.once(r.ERROR,n.stopRead.bind(n)),n._readCallback=function(t,i){e({humidity:t,temperature:i})},n._board.on(r.SYSEX_MESSAGE,n._messageHandler),n.on(u.READ,n._readCallback),(i=function(){n._board.sendSysex(a[0],[a[1],n._pin.number]),t&&(t=Math.max(t,c),null===n._lastRecv||Date.now()-n._lastRecv<5*t?n._readTimer=setTimeout(i,t):n.stopRead())})())},s.stopRead=function(){this.removeListener(u.READ,this._readCallback),this._board.removeListener(r.SYSEX_MESSAGE,this._messageHandler),this._lastRecv=null,this._readTimer&&(clearTimeout(this._readTimer),delete this._readTimer)},e.module.DhtEvent=u,e.module.Dht=t}),+function(e){"undefined"==typeof exports?e(webduino||{}):module.exports=e}(function(e){"use strict";function t(e,t){r.call(this),this._board=e,this._pin=t}function i(e,i){for(var s=0,o=0;e>o;o++)s+=n(i[o])+t.TONE_DELAY;return s}function n(e){return e=isNaN(e=parseInt(e))?c:e,
Math.max(e,c)}var s,o=e.util,r=e.Module,a=[4,7],c=100,u={REST:0,B0:31,C1:33,CS1:35,D1:37,DS1:39,E1:41,F1:44,FS1:46,G1:49,GS1:52,A1:55,AS1:58,B1:62,C2:65,CS2:69,D2:73,DS2:78,E2:82,F2:87,FS2:93,G2:98,GS2:104,A2:110,AS2:117,B2:123,C3:131,CS3:139,D3:147,DS3:156,E3:165,F3:175,FS3:185,G3:196,GS3:208,A3:220,AS3:233,B3:247,C4:262,CS4:277,D4:294,DS4:311,E4:330,F4:349,FS4:370,G4:392,GS4:415,A4:440,AS4:466,B4:494,C5:523,CS5:554,D5:587,DS5:622,E5:659,F5:698,FS5:740,G5:784,GS5:831,A5:880,AS5:932,B5:988,C6:1047,CS6:1109,D6:1175,DS6:1245,E6:1319,F6:1397,FS6:1480,G6:1568,GS6:1661,A6:1760,AS6:1865,B6:1976,C7:2093,CS7:2217,D7:2349,DS7:2489,E7:2637,F7:2794,FS7:2960,G7:3136,GS7:3322,A7:3520,AS7:3729,B7:3951,C8:4186,CS8:4435,D8:4699,DS8:4978};t.prototype=s=Object.create(r.prototype,{constructor:{value:t}}),s.tone=function(e,t){var i=[];isNaN(e=parseInt(e))||0>=e||e>9999||(e=("0000"+e).substr(-4,4),i[0]=parseInt("0x"+e[0]+e[1]),i[1]=parseInt("0x"+e[2]+e[3]),t=Math.round(n(t)/c),this._board.sendSysex(a[0],[a[1],this._pin.number].concat(i).concat(t)))},s.play=function(e,t){for(var n=this,s=e.length,r=(o.isArray(t)?t:[]).map(function(e){return 1e3/e}),a=0;s>a;a++)setTimeout(function(t){return function(){n.tone(u[e[t].toUpperCase()],r[t])}}(a),i(a,r))},t.FREQUENCY=u,t.TONE_DELAY=60,e.module.Buzzer=t});