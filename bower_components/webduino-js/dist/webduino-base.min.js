"undefined"==typeof Paho&&(Paho={}),Paho.MQTT=function(e){function t(e,t){var s=t,i=e[t],r=i>>4,o=i&=15;t+=1;var a,h=0,l=1;do{if(t==e.length)return[null,s];a=e[t++],h+=(127&a)*l,l*=128}while(0!=(128&a));var f=t+h;if(f>e.length)return[null,s];var d=new v(r);switch(r){case u.CONNACK:var _=e[t++];1&_&&(d.sessionPresent=!0),d.returnCode=e[t++];break;case u.PUBLISH:var g=o>>1&3,p=n(e,t);t+=2;var m=c(e,t,p);t+=p,g>0&&(d.messageIdentifier=n(e,t),t+=2);var E=new Paho.MQTT.Message(e.subarray(t,f));1==(1&o)&&(E.retained=!0),8==(8&o)&&(E.duplicate=!0),E.qos=g,E.destinationName=m,d.payloadMessage=E;break;case u.PUBACK:case u.PUBREC:case u.PUBREL:case u.PUBCOMP:case u.UNSUBACK:d.messageIdentifier=n(e,t);break;case u.SUBACK:d.messageIdentifier=n(e,t),t+=2,d.returnCode=e.subarray(t,f)}return[d,f]}function s(e,t,s){return t[s++]=e>>8,t[s++]=e%256,s}function i(e,t,i,n){return n=s(t,i,n),a(e,i,n),n+t}function n(e,t){return 256*e[t]+e[t+1]}function r(e){var t=new Array(1),s=0;do{var i=e%128;e>>=7,e>0&&(i|=128),t[s++]=i}while(e>0&&4>s);return t}function o(e){for(var t=0,s=0;s<e.length;s++){var i=e.charCodeAt(s);i>2047?(i>=55296&&56319>=i&&(s++,t++),t+=3):i>127?t+=2:t++}return t}function a(e,t,s){for(var i=s,n=0;n<e.length;n++){var r=e.charCodeAt(n);if(r>=55296&&56319>=r){var o=e.charCodeAt(++n);if(isNaN(o))throw new Error(g(d.MALFORMED_UNICODE,[r,o]));r=(r-55296<<10)+(o-56320)+65536}127>=r?t[i++]=r:2047>=r?(t[i++]=r>>6&31|192,t[i++]=63&r|128):65535>=r?(t[i++]=r>>12&15|224,t[i++]=r>>6&63|128,t[i++]=63&r|128):(t[i++]=r>>18&7|240,t[i++]=r>>12&63|128,t[i++]=r>>6&63|128,t[i++]=63&r|128)}return t}function c(e,t,s){for(var i,n="",r=t;t+s>r;){var o=e[r++];if(128>o)i=o;else{var a=e[r++]-128;if(0>a)throw new Error(g(d.MALFORMED_UTF,[o.toString(16),a.toString(16),""]));if(224>o)i=64*(o-192)+a;else{var c=e[r++]-128;if(0>c)throw new Error(g(d.MALFORMED_UTF,[o.toString(16),a.toString(16),c.toString(16)]));if(240>o)i=4096*(o-224)+64*a+c;else{var h=e[r++]-128;if(0>h)throw new Error(g(d.MALFORMED_UTF,[o.toString(16),a.toString(16),c.toString(16),h.toString(16)]));if(!(248>o))throw new Error(g(d.MALFORMED_UTF,[o.toString(16),a.toString(16),c.toString(16),h.toString(16)]));i=262144*(o-240)+4096*a+64*c+h}}}i>65535&&(i-=65536,n+=String.fromCharCode(55296+(i>>10)),i=56320+(1023&i)),n+=String.fromCharCode(i)}return n}var h="@VERSION@",u={CONNECT:1,CONNACK:2,PUBLISH:3,PUBACK:4,PUBREC:5,PUBREL:6,PUBCOMP:7,SUBSCRIBE:8,SUBACK:9,UNSUBSCRIBE:10,UNSUBACK:11,PINGREQ:12,PINGRESP:13,DISCONNECT:14},l=function(e,t){for(var s in e)if(e.hasOwnProperty(s)){if(!t.hasOwnProperty(s)){var i="Unknown property, "+s+". Valid properties are:";for(var s in t)t.hasOwnProperty(s)&&(i=i+" "+s);throw new Error(i)}if(typeof e[s]!==t[s])throw new Error(g(d.INVALID_TYPE,[typeof e[s],s]))}},f=function(e,t){return function(){return e.apply(t,arguments)}},d={OK:{code:0,text:"AMQJSC0000I OK."},CONNECT_TIMEOUT:{code:1,text:"AMQJSC0001E Connect timed out."},SUBSCRIBE_TIMEOUT:{code:2,text:"AMQJS0002E Subscribe timed out."},UNSUBSCRIBE_TIMEOUT:{code:3,text:"AMQJS0003E Unsubscribe timed out."},PING_TIMEOUT:{code:4,text:"AMQJS0004E Ping timed out."},INTERNAL_ERROR:{code:5,text:"AMQJS0005E Internal error. Error Message: {0}, Stack trace: {1}"},CONNACK_RETURNCODE:{code:6,text:"AMQJS0006E Bad Connack return code:{0} {1}."},SOCKET_ERROR:{code:7,text:"AMQJS0007E Socket error:{0}."},SOCKET_CLOSE:{code:8,text:"AMQJS0008I Socket closed."},MALFORMED_UTF:{code:9,text:"AMQJS0009E Malformed UTF data:{0} {1} {2}."},UNSUPPORTED:{code:10,text:"AMQJS0010E {0} is not supported by this browser."},INVALID_STATE:{code:11,text:"AMQJS0011E Invalid state {0}."},INVALID_TYPE:{code:12,text:"AMQJS0012E Invalid type {0} for {1}."},INVALID_ARGUMENT:{code:13,text:"AMQJS0013E Invalid argument {0} for {1}."},UNSUPPORTED_OPERATION:{code:14,text:"AMQJS0014E Unsupported operation."},INVALID_STORED_DATA:{code:15,text:"AMQJS0015E Invalid data in local storage key={0} value={1}."},INVALID_MQTT_MESSAGE_TYPE:{code:16,text:"AMQJS0016E Invalid MQTT message type {0}."},MALFORMED_UNICODE:{code:17,text:"AMQJS0017E Malformed Unicode string:{0} {1}."}},_={0:"Connection Accepted",1:"Connection Refused: unacceptable protocol version",2:"Connection Refused: identifier rejected",3:"Connection Refused: server unavailable",4:"Connection Refused: bad user name or password",5:"Connection Refused: not authorized"},g=function(e,t){var s=e.text;if(t)for(var i,n,r=0;r<t.length;r++)if(i="{"+r+"}",n=s.indexOf(i),n>0){var o=s.substring(0,n),a=s.substring(n+i.length);s=o+t[r]+a}return s},p=[0,6,77,81,73,115,100,112,3],m=[0,4,77,81,84,84,4],v=function(e,t){this.type=e;for(var s in t)t.hasOwnProperty(s)&&(this[s]=t[s])};v.prototype.encode=function(){var e=(15&this.type)<<4,t=0,n=new Array,a=0;switch(void 0!=this.messageIdentifier&&(t+=2),this.type){case u.CONNECT:switch(this.mqttVersion){case 3:t+=p.length+3;break;case 4:t+=m.length+3}if(t+=o(this.clientId)+2,void 0!=this.willMessage){t+=o(this.willMessage.destinationName)+2;var c=this.willMessage.payloadBytes;c instanceof Uint8Array||(c=new Uint8Array(l)),t+=c.byteLength+2}void 0!=this.userName&&(t+=o(this.userName)+2),void 0!=this.password&&(t+=o(this.password)+2);break;case u.SUBSCRIBE:e|=2;for(var h=0;h<this.topics.length;h++)n[h]=o(this.topics[h]),t+=n[h]+2;t+=this.requestedQos.length;break;case u.UNSUBSCRIBE:e|=2;for(var h=0;h<this.topics.length;h++)n[h]=o(this.topics[h]),t+=n[h]+2;break;case u.PUBREL:e|=2;break;case u.PUBLISH:this.payloadMessage.duplicate&&(e|=8),e=e|=this.payloadMessage.qos<<1,this.payloadMessage.retained&&(e|=1),a=o(this.payloadMessage.destinationName),t+=a+2;var l=this.payloadMessage.payloadBytes;t+=l.byteLength,l instanceof ArrayBuffer?l=new Uint8Array(l):l instanceof Uint8Array||(l=new Uint8Array(l.buffer));break;case u.DISCONNECT:}var f=r(t),d=f.length+1,_=new ArrayBuffer(t+d),g=new Uint8Array(_);if(g[0]=e,g.set(f,1),this.type==u.PUBLISH)d=i(this.payloadMessage.destinationName,a,g,d);else if(this.type==u.CONNECT){switch(this.mqttVersion){case 3:g.set(p,d),d+=p.length;break;case 4:g.set(m,d),d+=m.length}var v=0;this.cleanSession&&(v=2),void 0!=this.willMessage&&(v|=4,v|=this.willMessage.qos<<3,this.willMessage.retained&&(v|=32)),void 0!=this.userName&&(v|=128),void 0!=this.password&&(v|=64),g[d++]=v,d=s(this.keepAliveInterval,g,d)}switch(void 0!=this.messageIdentifier&&(d=s(this.messageIdentifier,g,d)),this.type){case u.CONNECT:d=i(this.clientId,o(this.clientId),g,d),void 0!=this.willMessage&&(d=i(this.willMessage.destinationName,o(this.willMessage.destinationName),g,d),d=s(c.byteLength,g,d),g.set(c,d),d+=c.byteLength),void 0!=this.userName&&(d=i(this.userName,o(this.userName),g,d)),void 0!=this.password&&(d=i(this.password,o(this.password),g,d));break;case u.PUBLISH:g.set(l,d);break;case u.SUBSCRIBE:for(var h=0;h<this.topics.length;h++)d=i(this.topics[h],n[h],g,d),g[d++]=this.requestedQos[h];break;case u.UNSUBSCRIBE:for(var h=0;h<this.topics.length;h++)d=i(this.topics[h],n[h],g,d)}return _};var E=function(e,t,s){this._client=e,this._window=t,this._keepAliveInterval=1e3*s,this.isReset=!1;var i=new v(u.PINGREQ).encode(),n=function(e){return function(){return r.apply(e)}},r=function(){this.isReset?(this.isReset=!1,this._client._trace("Pinger.doPing","send PINGREQ"),this._client.socket.send(i),this.timeout=this._window.setTimeout(n(this),this._keepAliveInterval)):(this._client._trace("Pinger.doPing","Timed out"),this._client._disconnected(d.PING_TIMEOUT.code,g(d.PING_TIMEOUT)))};this.reset=function(){this.isReset=!0,this._window.clearTimeout(this.timeout),this._keepAliveInterval>0&&(this.timeout=setTimeout(n(this),this._keepAliveInterval))},this.cancel=function(){this._window.clearTimeout(this.timeout)}},y=function(e,t,s,i,n){this._window=t,s||(s=30);var r=function(e,t,s){return function(){return e.apply(t,s)}};this.timeout=setTimeout(r(i,e,n),1e3*s),this.cancel=function(){this._window.clearTimeout(this.timeout)}},w=function(t,s,i,n,r){if(!("WebSocket"in e&&null!==e.WebSocket))throw new Error(g(d.UNSUPPORTED,["WebSocket"]));if(!("localStorage"in e&&null!==e.localStorage))throw new Error(g(d.UNSUPPORTED,["localStorage"]));if(!("ArrayBuffer"in e&&null!==e.ArrayBuffer))throw new Error(g(d.UNSUPPORTED,["ArrayBuffer"]));this._trace("Paho.MQTT.Client",t,s,i,n,r),this.host=s,this.port=i,this.path=n,this.uri=t,this.clientId=r,this._localKey=s+":"+i+("/mqtt"!=n?":"+n:"")+":"+r+":",this._msg_queue=[],this._sentMessages={},this._receivedMessages={},this._notify_msg_sent={},this._message_identifier=1,this._sequence=0;for(var o in localStorage)(0==o.indexOf("Sent:"+this._localKey)||0==o.indexOf("Received:"+this._localKey))&&this.restore(o)};w.prototype.host,w.prototype.port,w.prototype.path,w.prototype.uri,w.prototype.clientId,w.prototype.socket,w.prototype.connected=!1,w.prototype.maxMessageIdentifier=65536,w.prototype.connectOptions,w.prototype.hostIndex,w.prototype.onConnectionLost,w.prototype.onMessageDelivered,w.prototype.onMessageArrived,w.prototype.traceFunction,w.prototype._msg_queue=null,w.prototype._connectTimeout,w.prototype.sendPinger=null,w.prototype.receivePinger=null,w.prototype.receiveBuffer=null,w.prototype._traceBuffer=null,w.prototype._MAX_TRACE_ENTRIES=100,w.prototype.connect=function(e){var t=this._traceMask(e,"password");if(this._trace("Client.connect",t,this.socket,this.connected),this.connected)throw new Error(g(d.INVALID_STATE,["already connected"]));if(this.socket)throw new Error(g(d.INVALID_STATE,["already connected"]));this.connectOptions=e,e.uris?(this.hostIndex=0,this._doConnect(e.uris[0])):this._doConnect(this.uri)},w.prototype.subscribe=function(e,t){if(this._trace("Client.subscribe",e,t),!this.connected)throw new Error(g(d.INVALID_STATE,["not connected"]));var s=new v(u.SUBSCRIBE);s.topics=[e],s.requestedQos=void 0!=t.qos?[t.qos]:[0],t.onSuccess&&(s.onSuccess=function(e){t.onSuccess({invocationContext:t.invocationContext,grantedQos:e})}),t.onFailure&&(s.onFailure=function(e){t.onFailure({invocationContext:t.invocationContext,errorCode:e})}),t.timeout&&(s.timeOut=new y(this,window,t.timeout,t.onFailure,[{invocationContext:t.invocationContext,errorCode:d.SUBSCRIBE_TIMEOUT.code,errorMessage:g(d.SUBSCRIBE_TIMEOUT)}])),this._requires_ack(s),this._schedule_message(s)},w.prototype.unsubscribe=function(e,t){if(this._trace("Client.unsubscribe",e,t),!this.connected)throw new Error(g(d.INVALID_STATE,["not connected"]));var s=new v(u.UNSUBSCRIBE);s.topics=[e],t.onSuccess&&(s.callback=function(){t.onSuccess({invocationContext:t.invocationContext})}),t.timeout&&(s.timeOut=new y(this,window,t.timeout,t.onFailure,[{invocationContext:t.invocationContext,errorCode:d.UNSUBSCRIBE_TIMEOUT.code,errorMessage:g(d.UNSUBSCRIBE_TIMEOUT)}])),this._requires_ack(s),this._schedule_message(s)},w.prototype.send=function(e){if(this._trace("Client.send",e),!this.connected)throw new Error(g(d.INVALID_STATE,["not connected"]));wireMessage=new v(u.PUBLISH),wireMessage.payloadMessage=e,e.qos>0?this._requires_ack(wireMessage):this.onMessageDelivered&&(this._notify_msg_sent[wireMessage]=this.onMessageDelivered(wireMessage.payloadMessage)),this._schedule_message(wireMessage)},w.prototype.disconnect=function(){if(this._trace("Client.disconnect"),!this.socket)throw new Error(g(d.INVALID_STATE,["not connecting or connected"]));wireMessage=new v(u.DISCONNECT),this._notify_msg_sent[wireMessage]=f(this._disconnected,this),this._schedule_message(wireMessage)},w.prototype.getTraceLog=function(){if(null!==this._traceBuffer){this._trace("Client.getTraceLog",new Date),this._trace("Client.getTraceLog in flight messages",this._sentMessages.length);for(var e in this._sentMessages)this._trace("_sentMessages ",e,this._sentMessages[e]);for(var e in this._receivedMessages)this._trace("_receivedMessages ",e,this._receivedMessages[e]);return this._traceBuffer}},w.prototype.startTrace=function(){null===this._traceBuffer&&(this._traceBuffer=[]),this._trace("Client.startTrace",new Date,h)},w.prototype.stopTrace=function(){delete this._traceBuffer},w.prototype._doConnect=function(e){if(this.connectOptions.useSSL){var t=e.split(":");t[0]="wss",e=t.join(":")}this.connected=!1,this.socket=this.connectOptions.mqttVersion<4?new WebSocket(e,["mqttv3.1"]):new WebSocket(e,["mqtt"]),this.socket.binaryType="arraybuffer",this.socket.onopen=f(this._on_socket_open,this),this.socket.onmessage=f(this._on_socket_message,this),this.socket.onerror=f(this._on_socket_error,this),this.socket.onclose=f(this._on_socket_close,this),this.sendPinger=new E(this,window,this.connectOptions.keepAliveInterval),this.receivePinger=new E(this,window,this.connectOptions.keepAliveInterval),this._connectTimeout=new y(this,window,this.connectOptions.timeout,this._disconnected,[d.CONNECT_TIMEOUT.code,g(d.CONNECT_TIMEOUT)])},w.prototype._schedule_message=function(e){this._msg_queue.push(e),this.connected&&this._process_queue()},w.prototype.store=function(e,t){var s={type:t.type,messageIdentifier:t.messageIdentifier,version:1};switch(t.type){case u.PUBLISH:t.pubRecReceived&&(s.pubRecReceived=!0),s.payloadMessage={};for(var i="",n=t.payloadMessage.payloadBytes,r=0;r<n.length;r++)n[r]<=15?i=i+"0"+n[r].toString(16):i+=n[r].toString(16);s.payloadMessage.payloadHex=i,s.payloadMessage.qos=t.payloadMessage.qos,s.payloadMessage.destinationName=t.payloadMessage.destinationName,t.payloadMessage.duplicate&&(s.payloadMessage.duplicate=!0),t.payloadMessage.retained&&(s.payloadMessage.retained=!0),0==e.indexOf("Sent:")&&(void 0===t.sequence&&(t.sequence=++this._sequence),s.sequence=t.sequence);break;default:throw Error(g(d.INVALID_STORED_DATA,[key,s]))}localStorage.setItem(e+this._localKey+t.messageIdentifier,JSON.stringify(s))},w.prototype.restore=function(e){var t=localStorage.getItem(e),s=JSON.parse(t),i=new v(s.type,s);switch(s.type){case u.PUBLISH:for(var n=s.payloadMessage.payloadHex,r=new ArrayBuffer(n.length/2),o=new Uint8Array(r),a=0;n.length>=2;){var c=parseInt(n.substring(0,2),16);n=n.substring(2,n.length),o[a++]=c}var h=new Paho.MQTT.Message(o);h.qos=s.payloadMessage.qos,h.destinationName=s.payloadMessage.destinationName,s.payloadMessage.duplicate&&(h.duplicate=!0),s.payloadMessage.retained&&(h.retained=!0),i.payloadMessage=h;break;default:throw Error(g(d.INVALID_STORED_DATA,[e,t]))}0==e.indexOf("Sent:"+this._localKey)?(i.payloadMessage.duplicate=!0,this._sentMessages[i.messageIdentifier]=i):0==e.indexOf("Received:"+this._localKey)&&(this._receivedMessages[i.messageIdentifier]=i)},w.prototype._process_queue=function(){for(var e=null,t=this._msg_queue.reverse();e=t.pop();)this._socket_send(e),this._notify_msg_sent[e]&&(this._notify_msg_sent[e](),delete this._notify_msg_sent[e])},w.prototype._requires_ack=function(e){var t=Object.keys(this._sentMessages).length;if(t>this.maxMessageIdentifier)throw Error("Too many messages:"+t);for(;void 0!==this._sentMessages[this._message_identifier];)this._message_identifier++;e.messageIdentifier=this._message_identifier,this._sentMessages[e.messageIdentifier]=e,e.type===u.PUBLISH&&this.store("Sent:",e),this._message_identifier===this.maxMessageIdentifier&&(this._message_identifier=1)},w.prototype._on_socket_open=function(){var e=new v(u.CONNECT,this.connectOptions);e.clientId=this.clientId,this._socket_send(e)},w.prototype._on_socket_message=function(e){this._trace("Client._on_socket_message",e.data),this.receivePinger.reset();for(var t=this._deframeMessages(e.data),s=0;s<t.length;s+=1)this._handleMessage(t[s])},w.prototype._deframeMessages=function(e){var s=new Uint8Array(e);if(this.receiveBuffer){var i=new Uint8Array(this.receiveBuffer.length+s.length);i.set(this.receiveBuffer),i.set(s,this.receiveBuffer.length),s=i,delete this.receiveBuffer}try{for(var n=0,r=[];n<s.length;){var o=t(s,n),a=o[0];if(n=o[1],null===a)break;r.push(a)}n<s.length&&(this.receiveBuffer=s.subarray(n))}catch(c){return void this._disconnected(d.INTERNAL_ERROR.code,g(d.INTERNAL_ERROR,[c.message,c.stack.toString()]))}return r},w.prototype._handleMessage=function(e){this._trace("Client._handleMessage",e);try{switch(e.type){case u.CONNACK:if(this._connectTimeout.cancel(),this.connectOptions.cleanSession){for(var t in this._sentMessages){var s=this._sentMessages[t];localStorage.removeItem("Sent:"+this._localKey+s.messageIdentifier)}this._sentMessages={};for(var t in this._receivedMessages){var i=this._receivedMessages[t];localStorage.removeItem("Received:"+this._localKey+i.messageIdentifier)}this._receivedMessages={}}if(0!==e.returnCode){this._disconnected(d.CONNACK_RETURNCODE.code,g(d.CONNACK_RETURNCODE,[e.returnCode,_[e.returnCode]]));break}this.connected=!0,this.connectOptions.uris&&(this.hostIndex=this.connectOptions.uris.length);var n=new Array;for(var r in this._sentMessages)this._sentMessages.hasOwnProperty(r)&&n.push(this._sentMessages[r]);for(var n=n.sort(function(e,t){return e.sequence-t.sequence}),o=0,a=n.length;a>o;o++){var s=n[o];if(s.type==u.PUBLISH&&s.pubRecReceived){var c=new v(u.PUBREL,{messageIdentifier:s.messageIdentifier});this._schedule_message(c)}else this._schedule_message(s)}this.connectOptions.onSuccess&&this.connectOptions.onSuccess({invocationContext:this.connectOptions.invocationContext}),this._process_queue();break;case u.PUBLISH:this._receivePublish(e);break;case u.PUBACK:var s=this._sentMessages[e.messageIdentifier];s&&(delete this._sentMessages[e.messageIdentifier],localStorage.removeItem("Sent:"+this._localKey+e.messageIdentifier),this.onMessageDelivered&&this.onMessageDelivered(s.payloadMessage));break;case u.PUBREC:var s=this._sentMessages[e.messageIdentifier];if(s){s.pubRecReceived=!0;var c=new v(u.PUBREL,{messageIdentifier:e.messageIdentifier});this.store("Sent:",s),this._schedule_message(c)}break;case u.PUBREL:var i=this._receivedMessages[e.messageIdentifier];localStorage.removeItem("Received:"+this._localKey+e.messageIdentifier),i&&(this._receiveMessage(i),delete this._receivedMessages[e.messageIdentifier]);var h=new v(u.PUBCOMP,{messageIdentifier:e.messageIdentifier});this._schedule_message(h);break;case u.PUBCOMP:var s=this._sentMessages[e.messageIdentifier];delete this._sentMessages[e.messageIdentifier],localStorage.removeItem("Sent:"+this._localKey+e.messageIdentifier),this.onMessageDelivered&&this.onMessageDelivered(s.payloadMessage);break;case u.SUBACK:var s=this._sentMessages[e.messageIdentifier];s&&(s.timeOut&&s.timeOut.cancel(),e.returnCode.indexOf=Array.prototype.indexOf,-1!==e.returnCode.indexOf(128)?s.onFailure&&s.onFailure(e.returnCode):s.onSuccess&&s.onSuccess(e.returnCode),delete this._sentMessages[e.messageIdentifier]);break;case u.UNSUBACK:var s=this._sentMessages[e.messageIdentifier];s&&(s.timeOut&&s.timeOut.cancel(),s.callback&&s.callback(),delete this._sentMessages[e.messageIdentifier]);break;case u.PINGRESP:this.sendPinger.reset();break;case u.DISCONNECT:this._disconnected(d.INVALID_MQTT_MESSAGE_TYPE.code,g(d.INVALID_MQTT_MESSAGE_TYPE,[e.type]));break;default:this._disconnected(d.INVALID_MQTT_MESSAGE_TYPE.code,g(d.INVALID_MQTT_MESSAGE_TYPE,[e.type]))}}catch(l){return void this._disconnected(d.INTERNAL_ERROR.code,g(d.INTERNAL_ERROR,[l.message,l.stack.toString()]))}},w.prototype._on_socket_error=function(e){this._disconnected(d.SOCKET_ERROR.code,g(d.SOCKET_ERROR,[e.data]))},w.prototype._on_socket_close=function(){this._disconnected(d.SOCKET_CLOSE.code,g(d.SOCKET_CLOSE))},w.prototype._socket_send=function(e){if(1==e.type){var t=this._traceMask(e,"password");this._trace("Client._socket_send",t)}else this._trace("Client._socket_send",e);this.socket.send(e.encode()),this.sendPinger.reset()},w.prototype._receivePublish=function(e){switch(e.payloadMessage.qos){case"undefined":case 0:this._receiveMessage(e);break;case 1:var t=new v(u.PUBACK,{messageIdentifier:e.messageIdentifier});this._schedule_message(t),this._receiveMessage(e);break;case 2:this._receivedMessages[e.messageIdentifier]=e,this.store("Received:",e);var s=new v(u.PUBREC,{messageIdentifier:e.messageIdentifier});this._schedule_message(s);break;default:throw Error("Invaild qos="+wireMmessage.payloadMessage.qos)}},w.prototype._receiveMessage=function(e){this.onMessageArrived&&this.onMessageArrived(e.payloadMessage)},w.prototype._disconnected=function(e,t){this._trace("Client._disconnected",e,t),this.sendPinger.cancel(),this.receivePinger.cancel(),this._connectTimeout&&this._connectTimeout.cancel(),this._msg_queue=[],this._notify_msg_sent={},this.socket&&(this.socket.onopen=null,this.socket.onmessage=null,this.socket.onerror=null,this.socket.onclose=null,1===this.socket.readyState&&this.socket.close(),delete this.socket),this.connectOptions.uris&&this.hostIndex<this.connectOptions.uris.length-1?(this.hostIndex++,this._doConnect(this.connectOptions.uris[this.hostIndex])):(void 0===e&&(e=d.OK.code,t=g(d.OK)),this.connected?(this.connected=!1,this.onConnectionLost&&this.onConnectionLost({errorCode:e,errorMessage:t})):4===this.connectOptions.mqttVersion&&this.connectOptions.mqttVersionExplicit===!1?(this._trace("Failed to connect V4, dropping back to V3"),this.connectOptions.mqttVersion=3,this.connectOptions.uris?(this.hostIndex=0,this._doConnect(this.connectOptions.uris[0])):this._doConnect(this.uri)):this.connectOptions.onFailure&&this.connectOptions.onFailure({invocationContext:this.connectOptions.invocationContext,errorCode:e,errorMessage:t}))},w.prototype._trace=function(){if(this.traceFunction){for(var e in arguments)"undefined"!=typeof arguments[e]&&(arguments[e]=JSON.stringify(arguments[e]));var t=Array.prototype.slice.call(arguments).join("");this.traceFunction({severity:"Debug",message:t})}if(null!==this._traceBuffer)for(var e=0,s=arguments.length;s>e;e++)this._traceBuffer.length==this._MAX_TRACE_ENTRIES&&this._traceBuffer.shift(),this._traceBuffer.push(0===e?arguments[e]:"undefined"==typeof arguments[e]?arguments[e]:"  "+JSON.stringify(arguments[e]))},w.prototype._traceMask=function(e,t){var s={};for(var i in e)e.hasOwnProperty(i)&&(s[i]=i==t?"******":e[i]);return s};var I=function(e,t,s,i){var n;if("string"!=typeof e)throw new Error(g(d.INVALID_TYPE,[typeof e,"host"]));if(2==arguments.length){i=t,n=e;var r=n.match(/^(wss?):\/\/((\[(.+)\])|([^\/]+?))(:(\d+))?(\/.*)$/);if(!r)throw new Error(g(d.INVALID_ARGUMENT,[e,"host"]));e=r[4]||r[2],t=parseInt(r[7]),s=r[8]}else{if(3==arguments.length&&(i=s,s="/mqtt"),"number"!=typeof t||0>t)throw new Error(g(d.INVALID_TYPE,[typeof t,"port"]));if("string"!=typeof s)throw new Error(g(d.INVALID_TYPE,[typeof s,"path"]));var o=-1!=e.indexOf(":")&&"["!=e.slice(0,1)&&"]"!=e.slice(-1);n="ws://"+(o?"["+e+"]":e)+":"+t+s}for(var a=0,c=0;c<i.length;c++){var h=i.charCodeAt(c);h>=55296&&56319>=h&&c++,a++}if("string"!=typeof i||a>65535)throw new Error(g(d.INVALID_ARGUMENT,[i,"clientId"]));var u=new w(n,e,t,s,i);this._getHost=function(){return e},this._setHost=function(){throw new Error(g(d.UNSUPPORTED_OPERATION))},this._getPort=function(){return t},this._setPort=function(){throw new Error(g(d.UNSUPPORTED_OPERATION))},this._getPath=function(){return s},this._setPath=function(){throw new Error(g(d.UNSUPPORTED_OPERATION))},this._getURI=function(){return n},this._setURI=function(){throw new Error(g(d.UNSUPPORTED_OPERATION))},this._getClientId=function(){return u.clientId},this._setClientId=function(){throw new Error(g(d.UNSUPPORTED_OPERATION))},this._getOnConnectionLost=function(){return u.onConnectionLost},this._setOnConnectionLost=function(e){if("function"!=typeof e)throw new Error(g(d.INVALID_TYPE,[typeof e,"onConnectionLost"]));u.onConnectionLost=e},this._getOnMessageDelivered=function(){return u.onMessageDelivered},this._setOnMessageDelivered=function(e){if("function"!=typeof e)throw new Error(g(d.INVALID_TYPE,[typeof e,"onMessageDelivered"]));u.onMessageDelivered=e},this._getOnMessageArrived=function(){return u.onMessageArrived},this._setOnMessageArrived=function(e){if("function"!=typeof e)throw new Error(g(d.INVALID_TYPE,[typeof e,"onMessageArrived"]));u.onMessageArrived=e},this._getTrace=function(){return u.traceFunction},this._setTrace=function(e){if("function"!=typeof e)throw new Error(g(d.INVALID_TYPE,[typeof e,"onTrace"]));u.traceFunction=e},this.connect=function(e){if(e=e||{},l(e,{timeout:"number",userName:"string",password:"string",willMessage:"object",keepAliveInterval:"number",cleanSession:"boolean",useSSL:"boolean",invocationContext:"object",onSuccess:"function",onFailure:"function",hosts:"object",ports:"object",mqttVersion:"number"}),void 0===e.keepAliveInterval&&(e.keepAliveInterval=60),e.mqttVersion>4||e.mqttVersion<3)throw new Error(g(d.INVALID_ARGUMENT,[e.mqttVersion,"connectOptions.mqttVersion"]));if(void 0===e.mqttVersion?(e.mqttVersionExplicit=!1,e.mqttVersion=4):e.mqttVersionExplicit=!0,void 0===e.password&&void 0!==e.userName)throw new Error(g(d.INVALID_ARGUMENT,[e.password,"connectOptions.password"]));if(e.willMessage){if(!(e.willMessage instanceof A))throw new Error(g(d.INVALID_TYPE,[e.willMessage,"connectOptions.willMessage"]));if(e.willMessage.stringPayload,"undefined"==typeof e.willMessage.destinationName)throw new Error(g(d.INVALID_TYPE,[typeof e.willMessage.destinationName,"connectOptions.willMessage.destinationName"]))}if("undefined"==typeof e.cleanSession&&(e.cleanSession=!0),e.hosts){if(!(e.hosts instanceof Array))throw new Error(g(d.INVALID_ARGUMENT,[e.hosts,"connectOptions.hosts"]));if(e.hosts.length<1)throw new Error(g(d.INVALID_ARGUMENT,[e.hosts,"connectOptions.hosts"]));for(var t=!1,i=0;i<e.hosts.length;i++){if("string"!=typeof e.hosts[i])throw new Error(g(d.INVALID_TYPE,[typeof e.hosts[i],"connectOptions.hosts["+i+"]"]));if(/^(wss?):\/\/((\[(.+)\])|([^\/]+?))(:(\d+))?(\/.*)$/.test(e.hosts[i])){if(0==i)t=!0;else if(!t)throw new Error(g(d.INVALID_ARGUMENT,[e.hosts[i],"connectOptions.hosts["+i+"]"]))}else if(t)throw new Error(g(d.INVALID_ARGUMENT,[e.hosts[i],"connectOptions.hosts["+i+"]"]))}if(t)e.uris=e.hosts;else{if(!e.ports)throw new Error(g(d.INVALID_ARGUMENT,[e.ports,"connectOptions.ports"]));if(!(e.ports instanceof Array))throw new Error(g(d.INVALID_ARGUMENT,[e.ports,"connectOptions.ports"]));if(e.hosts.length!=e.ports.length)throw new Error(g(d.INVALID_ARGUMENT,[e.ports,"connectOptions.ports"]));e.uris=[];for(var i=0;i<e.hosts.length;i++){if("number"!=typeof e.ports[i]||e.ports[i]<0)throw new Error(g(d.INVALID_TYPE,[typeof e.ports[i],"connectOptions.ports["+i+"]"]));var r=e.hosts[i],o=e.ports[i],a=-1!=r.indexOf(":");n="ws://"+(a?"["+r+"]":r)+":"+o+s,e.uris.push(n)}}}u.connect(e)},this.subscribe=function(e,t){if("string"!=typeof e)throw new Error("Invalid argument:"+e);if(t=t||{},l(t,{qos:"number",invocationContext:"object",onSuccess:"function",onFailure:"function",timeout:"number"}),t.timeout&&!t.onFailure)throw new Error("subscribeOptions.timeout specified with no onFailure callback.");if("undefined"!=typeof t.qos&&0!==t.qos&&1!==t.qos&&2!==t.qos)throw new Error(g(d.INVALID_ARGUMENT,[t.qos,"subscribeOptions.qos"]));u.subscribe(e,t)},this.unsubscribe=function(e,t){if("string"!=typeof e)throw new Error("Invalid argument:"+e);if(t=t||{},l(t,{invocationContext:"object",onSuccess:"function",onFailure:"function",timeout:"number"}),t.timeout&&!t.onFailure)throw new Error("unsubscribeOptions.timeout specified with no onFailure callback.");u.unsubscribe(e,t)},this.send=function(e,t,s,i){var n;if(0==arguments.length)throw new Error("Invalid argument.length");if(1==arguments.length){if(!(e instanceof A)&&"string"!=typeof e)throw new Error("Invalid argument:"+typeof e);if(n=e,"undefined"==typeof n.destinationName)throw new Error(g(d.INVALID_ARGUMENT,[n.destinationName,"Message.destinationName"]));u.send(n)}else n=new A(t),n.destinationName=e,arguments.length>=3&&(n.qos=s),arguments.length>=4&&(n.retained=i),u.send(n)},this.disconnect=function(){u.disconnect()},this.getTraceLog=function(){return u.getTraceLog()},this.startTrace=function(){u.startTrace()},this.stopTrace=function(){u.stopTrace()},this.isConnected=function(){return u.connected}};I.prototype={get host(){return this._getHost()},set host(e){this._setHost(e)},get port(){return this._getPort()},set port(e){this._setPort(e)},get path(){return this._getPath()},set path(e){this._setPath(e)},get clientId(){return this._getClientId()},set clientId(e){this._setClientId(e)},get onConnectionLost(){return this._getOnConnectionLost()},set onConnectionLost(e){this._setOnConnectionLost(e)},get onMessageDelivered(){return this._getOnMessageDelivered()},set onMessageDelivered(e){this._setOnMessageDelivered(e)},get onMessageArrived(){return this._getOnMessageArrived()},set onMessageArrived(e){this._setOnMessageArrived(e)},get trace(){return this._getTrace()},set trace(e){this._setTrace(e)}};var A=function(e){var t;if(!("string"==typeof e||e instanceof ArrayBuffer||e instanceof Int8Array||e instanceof Uint8Array||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array))throw g(d.INVALID_ARGUMENT,[e,"newPayload"]);t=e,this._getPayloadString=function(){return"string"==typeof t?t:c(t,0,t.length)},this._getPayloadBytes=function(){if("string"==typeof t){var e=new ArrayBuffer(o(t)),s=new Uint8Array(e);return a(t,s,0),s}return t};var s=void 0;this._getDestinationName=function(){return s},this._setDestinationName=function(e){if("string"!=typeof e)throw new Error(g(d.INVALID_ARGUMENT,[e,"newDestinationName"]));s=e};var i=0;this._getQos=function(){return i},this._setQos=function(e){if(0!==e&&1!==e&&2!==e)throw new Error("Invalid argument:"+e);i=e};var n=!1;this._getRetained=function(){return n},this._setRetained=function(e){if("boolean"!=typeof e)throw new Error(g(d.INVALID_ARGUMENT,[e,"newRetained"]));n=e};var r=!1;this._getDuplicate=function(){return r},this._setDuplicate=function(e){r=e}};return A.prototype={get payloadString(){return this._getPayloadString()},get payloadBytes(){return this._getPayloadBytes()},get destinationName(){return this._getDestinationName()},set destinationName(e){this._setDestinationName(e)},get qos(){return this._getQos()},set qos(e){this._setQos(e)},get retained(){return this._getRetained()},set retained(e){this._setRetained(e)},get duplicate(){return this._getDuplicate()},set duplicate(e){this._setDuplicate(e)}},{Client:I,Message:A}}(window);var webduino=webduino||{};"undefined"!=typeof exports&&(module.exports=webduino),+function(e){"undefined"==typeof exports?e(webduino||{}):module.exports=e}(function(e){"use strict";function t(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function s(e){return"function"==typeof e}function i(e){return"number"==typeof e}function n(e){return"object"==typeof e&&null!==e}function r(e){return void 0===e}var o;o=t.prototype,o._events=void 0,o._maxListeners=void 0,t.defaultMaxListeners=10,o.setMaxListeners=function(e){if(!i(e)||0>e||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},o.emit=function(e){var t,i,o,a,c;if(this._events||(this._events={}),t=this._events[e],r(t))return!1;if(s(t))switch(arguments.length){case 1:t.call(this);break;case 2:t.call(this,arguments[1]);break;case 3:t.call(this,arguments[1],arguments[2]);break;default:o=Array.prototype.slice.call(arguments,1),t.apply(this,o)}else if(n(t))for(o=Array.prototype.slice.call(arguments,1),c=t.slice(),i=c.length,a=0;i>a;a++)c[a].apply(this,o);return!0},o.addListener=function(e,i){var o;if(!s(i))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,s(i.listener)?i.listener:i),this._events[e]?n(this._events[e])?this._events[e].push(i):this._events[e]=[this._events[e],i]:this._events[e]=i,n(this._events[e])&&!this._events[e].warned&&(o=r(this._maxListeners)?t.defaultMaxListeners:this._maxListeners,o&&o>0&&this._events[e].length>o&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace())),this},o.on=o.addListener,o.once=function(e,t){function i(){this.removeListener(e,i),n||(n=!0,
t.apply(this,arguments))}if(!s(t))throw TypeError("listener must be a function");var n=!1;return i.listener=t,this.on(e,i),this},o.removeListener=function(e,t){var i,r,o,a;if(!s(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(i=this._events[e],o=i.length,r=-1,i===t||s(i.listener)&&i.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(n(i)){for(a=o;a-->0;)if(i[a]===t||i[a].listener&&i[a].listener===t){r=a;break}if(0>r)return this;1===i.length?(i.length=0,delete this._events[e]):i.splice(r,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},o.removeAllListeners=function(e){var t,i;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(i=this._events[e],s(i))this.removeListener(e,i);else if(i)for(;i.length;)this.removeListener(e,i[i.length-1]);return delete this._events[e],this},o.listeners=function(e){var t;return t=this._events&&this._events[e]?s(this._events[e])?[this._events[e]]:this._events[e].slice():[]},t.listenerCount=function(e,t){var i;return i=e._events&&e._events[t]?s(e._events[t])?1:e._events[t].length:0},e.EventEmitter=t}),+function(e){"undefined"==typeof exports?e(webduino||{}):module.exports=e}(function(e){"use strict";function t(e){return"function"==typeof e}function s(e){return"[object Object]"===a.call(e)}function i(e){return s(e)&&e.constructor===Object&&!e.nodeType&&!e.setInterval}function n(e){return"[object Array]"===a.call(e)}function r(){var e,s,o,a,c,h,u=arguments[0]||{},l=1,f=arguments.length,d=!1;for("boolean"==typeof u&&(d=u,u=arguments[1]||{},l=2),"object"==typeof u||t(u)||(u={});f>l;l++)if(e=arguments[l],null!==e){"string"==typeof e&&(e=e.split(""));for(s in e)o=u[s],a=e[s],u!==a&&(d&&a&&(i(a)||(c=n(a)))?(c?(c=!1,h=o&&n(o)?o:[]):h=o&&i(o)?o:{},u[s]=r(d,h,a)):"undefined"!=typeof a&&(u[s]=a))}return u}var o=Object.prototype,a=(o.hasOwnProperty,o.toString);e.util={isFn:t,isFunction:t,isObject:s,isHash:i,isArray:n,extend:r}}),+function(e){"undefined"==typeof exports?e(webduino||{}):module.exports=e}(function(e){"use strict";function t(e,t,s){this.resolve=e,this.reject=t,this.custom=s}function s(e,t,s){if("function"==typeof e.custom){var i=function(){return e.custom.apply(i,arguments)};i.resolve=e.resolve,i.reject=e.reject,i.call(null,t,s)}else{if(t)return e.reject(t);e.resolve(s)}}function i(e,i){return function(){var n=this,r=Array.prototype.slice.call(arguments);return new Promise(function(o,a){var c=new t(o,a,i);r.push(s.bind(null,c)),e.apply(n,r)})}}e.util.promisify=i}),+function(e){"undefined"==typeof exports?e(webduino||{}):module.exports=e}(function(e){"use strict";function t(e){i.call(this)}var s,i=e.EventEmitter,n={OPEN:"open",READY:"ready",MESSAGE:"message",ERROR:"error",CLOSE:"close"};t.prototype=s=Object.create(i.prototype,{constructor:{value:t}}),s.send=function(e){throw new Error("error: direct call on abstract method.")},s.close=function(){throw new Error("error: direct call on abstract method.")},e.TransportEvent=n,e.Transport=t,e.transport=e.transport||{}}),+function(e){"undefined"==typeof exports?e(webduino||{}):module.exports=e}(function(e){"use strict";function t(e){l.call(this,e),this._options=e,this._clientId="_"+(new Date).getTime(),this._client=null,this._timer=null,this._reconnTime=0,this._status="",this._buf=[],this._isReady=!1,this._connHandler=i.bind(this),this._messageHandler=n.bind(this),this._disconnHandler=o.bind(this),this._errorHandler=a.bind(this),s(this)}function s(e){e._client=new Paho.MQTT.Client(e._options.url,e._clientId),e._client.onMessageArrived=e._messageHandler,e._client.onConnectionLost=e._disconnHandler,e._client.connect({userName:e._options.login||"",password:e._options.password||"",timeout:t.CONNECT_TIMEOUT,keepAliveInterval:t.KEEPALIVE_INTERVAL,onSuccess:e._connHandler,onFailure:e._errorHandler})}function i(){h(this),this._isReady=!0,this._reconnTime=0,this.emit(f.OPEN),this._client.subscribe(this._options.device+_.PONG),this._client.subscribe(this._options.device+_.STATUS)}function n(e){var t=e.destinationName,s=this._status;switch(t.substr(t.lastIndexOf("/")+1)){case"STATUS":this._status=e.payloadString,r(this,this._status,s);break;default:this.emit(f.MESSAGE,e.payloadBytes)}}function r(e,t,s){t!==s&&(t===d.OK?e.emit(f.READY):e.emit(f.ERROR,new Error("error: board connection failed. (1)")))}function o(e){this.emit(f.ERROR,new Error(e.errorCode?e.errorMessage:"error: board connection failed. (2)")),this._isReady&&(this._isReady=!1,this.emit(f.CLOSE),c(this))}function a(e){this.emit(f.ERROR,new Error(e.errorMessage)),this._isReady||c(this)}function c(e){h(e),e.close(),e._timer=setTimeout(function(){e._reconnTime+=1e3*t.RECONNECT_PERIOD,e._reconnTime<1e3*t.CONNECT_TIMEOUT&&s(e)},1e3*t.RECONNECT_PERIOD)}function h(e){e._timer&&(clearTimeout(e._timer),delete e._timer)}var u,l=e.Transport,f=e.TransportEvent,d={OK:"OK"},_={PING:"/PING",PONG:"/PONG",STATUS:"/STATUS"};t.prototype=u=Object.create(l.prototype,{constructor:{value:t},isReady:{get:function(){return this._isReady}}}),u.send=function(e){this._buf=new Uint8Array(e.length?e:[e]),e=new Paho.MQTT.Message(this._buf),e.destinationName=this._options.device+_.PING,e.qos=0,this._client.send(e)},u.close=function(){this._isReady&&this._client.disconnect(),delete this._client},t.RECONNECT_PERIOD=5,t.KEEPALIVE_INTERVAL=30,t.CONNECT_TIMEOUT=60,e.transport.mqtt=t}),+function(e){"undefined"==typeof exports?e(webduino||{}):module.exports=e}(function(e){"use strict";function t(e,t){i.call(this),this._type=t,this._capabilities={},this._number=e,this._analogNumber=void 0,this._analogWriteResolution=255,this._analogReadResolution=1023,this._value=0,this._lastValue=-1,this._preFilterValue=0,this._average=0,this._minimum=Math.pow(2,16),this._maximum=0,this._sum=0,this._numSamples=0,this._filters=null,this._generator=null,this._state=void 0,this._autoSetValueCallback=this.autoSetValue.bind(this)}var s,i=e.EventEmitter,n={CHANGE:"change",RISING_EDGE:"risingEdge",FALLING_EDGE:"fallingEdge"};t.prototype=s=Object.create(i.prototype,{constructor:{value:t},capabilities:{get:function(){return this._capabilities}},analogNumber:{get:function(){return this._analogNumber}},number:{get:function(){return this._number}},analogWriteResolution:{get:function(){return this._analogWriteResolution}},analogReadResolution:{get:function(){return this._analogReadResolution}},state:{get:function(){return this._state}},average:{get:function(){return this._average}},minimum:{get:function(){return this._minimum}},maximum:{get:function(){return this._maximum}},value:{get:function(){return this._value},set:function(e){this._lastValue=this._value,this._preFilterValue=e,this._value=this.applyFilters(e),this.calculateMinMaxAndMean(this._value),this.detectChange(this._lastValue,this._value)}},lastValue:{get:function(){return this._lastValue}},preFilterValue:{get:function(){return this._preFilterValue}},filters:{get:function(){return this._filters},set:function(e){this._filters=e}},generator:{get:function(){return this._generator}}}),s.setAnalogNumber=function(e){this._analogNumber=e},s.setAnalogWriteResolution=function(e){this._analogWriteResolution=e},s.setAnalogReadResolution=function(e){this._analogReadResolution=e},s.setState=function(e){this._type===t.PWM&&(e/=this._analogWriteResolution),this._state=e},s.setType=function(e){e>=0&&e<t.TOTAL_PIN_MODES&&(this._type=e)},s.setCapabilities=function(e){this._capabilities=e;var s=this._capabilities[t.PWM],i=this._capabilities[t.AIN];s&&(this._analogWriteResolution=Math.pow(2,s)-1),i&&(this._analogReadResolution=Math.pow(2,i)-1)},s.detectChange=function(e,t){e!==t&&(this.emit(n.CHANGE,this),0>=e&&0!==t?this.emit(n.RISING_EDGE,this):0!==e&&0>=t&&this.emit(n.FALLING_EDGE,this))},s.clearWeight=function(){this._sum=this._average,this._numSamples=1},s.calculateMinMaxAndMean=function(e){var t=Number.MAX_VALUE;this._minimum=Math.min(e,this._minimum),this._maximum=Math.max(e,this._maximum),this._sum+=e,this._average=this._sum/++this._numSamples,this._numSamples>=t&&this.clearWeight()},s.clear=function(){this._minimum=this._maximum=this._average=this._lastValue=this._preFilterValue,this.clearWeight()},s.addFilter=function(e){null!==e&&(null===this._filters&&(this._filters=[]),this._filters.push(e))},s.removeFilter=function(e){var t;this._filters.length<1||(t=this._filters.indexOf(e),-1!==t&&this._filters.splice(t,1))},s.addGenerator=function(e){this.removeGenerator(),this._generator=e,this._generator.on("update",this._autoSetValueCallback)},s.removeGenerator=function(){null!==this._generator&&this._generator.removeListener("update",this._autoSetValueCallback),delete this._generator},s.removeAllFilters=function(){delete this._filters},s.autoSetValue=function(e){this.value=e},s.applyFilters=function(e){var t;if(null===this._filters)return e;t=e;for(var s=this._filters.length,i=0;s>i;i++)t=this._filters[i].processSample(t);return t},t.HIGH=1,t.LOW=0,t.ON=1,t.OFF=0,t.DIN=0,t.DOUT=1,t.AIN=2,t.AOUT=3,t.PWM=3,t.SERVO=4,t.SHIFT=5,t.I2C=6,t.ONEWIRE=7,t.STEPPER=8,t.TOTAL_PIN_MODES=9,e.PinEvent=n,e.Pin=t}),+function(e){"undefined"==typeof exports?e(webduino||{}):module.exports=e}(function(e){"use strict";function t(){s.call(this)}var s=e.EventEmitter;t.prototype=Object.create(s.prototype,{constructor:{value:t},type:{get:function(){return this._type}}}),e.Module=t,e.module=e.module||{}}),+function(e){"undefined"==typeof exports?e(webduino||{}):module.exports=e}(function(e){"use strict";function t(e){h.call(this),this._options=e,this._buf=[],this._digitalPort=[],this._numPorts=0,this._analogPinMapping=[],this._digitalPinMapping=[],this._i2cPins=[],this._ioPins=[],this._totalPins=0,this._totalAnalogPins=0,this._samplingInterval=19,this._isReady=!1,this._firmwareName="",this._firmwareVersion=0,this._capabilityQueryResponseReceived=!1,this._numPinStateRequests=0,this._transport=null,this._pinStateEventCenter=new h,this._initialVersionResultHandler=s.bind(this),this._sendOutHandler=i.bind(this),this._readyHandler=n.bind(this),this._messageHandler=r.bind(this),this._errorHandler=o.bind(this),this.setTransport(this._options.transport||0)}function s(e){{var t=10*e.version;e.name}if(!(t>=23))throw new Error("error: You must upload StandardFirmata version 2.3 or greater from Arduino version 1.0 or higher");this.queryCapabilities()}function i(e){var t=e._type,s=e.number,i=e.value;switch(t){case d.DOUT:this.sendDigitalData(s,i);break;case d.AOUT:this.sendAnalogData(s,i);break;case d.SERVO:this.sendServoData(s,i)}}function n(){this.begin()}function r(e){var t=e.length;if(t)for(var s=0;t>s;s++)this.processInput(e[s]);else this.processInput(e)}function o(e){this._isReady=!1,this.emit(g.ERROR,e)}function a(e){console&&console.log(e.stack||e)}var c,h=e.EventEmitter,u=e.TransportEvent,l=e.Transport,f=e.PinEvent,d=e.Pin,_=e.util,g={ANALOG_DATA:"analogData",DIGITAL_DATA:"digitalData",FIRMWARE_VERSION:"firmwareVersion",FIRMWARE_NAME:"firmwareName",STRING_MESSAGE:"stringMessage",SYSEX_MESSAGE:"sysexMessage",PIN_STATE_RESPONSE:"pinStateResponse",READY:"ready",ERROR:"error"},p=144,m=224,v=192,E=208,y=244,w=249,I=255,A=240,b=247,M=112,S=113,O=111,R=109,T=110,N=107,P=108,C=105,D=106,U=121,L=122,k=10,x=100;t.prototype=c=Object.create(h.prototype,{constructor:{value:t},samplingInterval:{get:function(){return this._samplingInterval},set:function(e){if(!(e>=k&&x>=e))throw new Error("warning: Sampling interval must be between "+k+" and "+x);this._samplingInterval=e,this.send([A,L,127&e,e>>7&127,b])}},isReady:{get:function(){return this._isReady}}}),c.begin=function(){this.once(g.FIRMWARE_NAME,this._initialVersionResultHandler),this.reportFirmware()},c.processInput=function(e){var t,s;e=parseInt(e,10),this._buf.push(e),t=this._buf.length,s=this._buf[0],s>=128&&s!==A?3===t&&(this.processMultiByteCommand(this._buf),this._buf=[]):s===A&&e===b?(this.processSysexCommand(this._buf),this._buf=[]):e>=128&&128>s&&(this._buf=[],e!==b&&this._buf.push(e))},c.processMultiByteCommand=function(e){var t,s=e[0];switch(240>s&&(s=240&s,t=15&e[0]),s){case p:this.processDigitalMessage(t,e[1],e[2]);break;case w:this._firmwareVersion=e[1]+e[2]/10,this.emit(g.FIRMWARE_VERSION,{version:this._firmwareVersion});break;case m:this.processAnalogMessage(t,e[1],e[2])}},c.processDigitalMessage=function(e,t,s){var i,n=8*e,r=n+8,o=t|s<<7,a={};r>=this._totalPins&&(r=this._totalPins);for(var c=0,h=n;r>h;h++){if(a=this.getDigitalPin(h),void 0===a)return;a._type===d.DIN&&(i=o>>c&1,i!==a.value&&(a.value=i,this.emit(g.DIGITAL_DATA,{pin:a}))),c++}},c.processAnalogMessage=function(e,t,s){var i=this.getAnalogPin(e);void 0!==i&&(i.value=this.getValueFromTwo7bitBytes(t,s)/i.analogReadResolution,i.value!==i.lastValue&&this.emit(g.ANALOG_DATA,{pin:i}))},c.processSysexCommand=function(e){e.shift(),e.pop();var t=e[0];switch(t){case U:this.processQueryFirmwareResult(e);break;case S:this.processSysExString(e);break;case P:this.processCapabilitiesResponse(e);break;case T:this.processPinStateResponse(e);break;case D:this.processAnalogMappingResponse(e);break;default:this.emit(g.SYSEX_MESSAGE,{message:e})}},c.processQueryFirmwareResult=function(e){for(var t,s=3,i=e.length;i>s;s+=2)t=e[s],t+=e[s+1],this._firmwareName+=String.fromCharCode(t);this._firmwareVersion=e[1]+e[2]/10,this.emit(g.FIRMWARE_NAME,{name:this._firmwareName,version:this._firmwareVersion})},c.processSysExString=function(e){for(var t,s="",i=e.length,n=1;i>n;n+=2)t=e[n],t+=e[n+1],s+=String.fromCharCode(t);this.emit(g.STRING_MESSAGE,{message:s})},c.processCapabilitiesResponse=function(e){var t,s,i={},n=1,r=0,o=0,a=e.length;for(this._capabilityQueryResponseReceived=!0;a>=n;)127===e[n]?(this._digitalPinMapping[r]=r,t=void 0,i[d.DOUT]&&(t=d.DOUT),i[d.AIN]&&(t=d.AIN,this._analogPinMapping[o++]=r),s=new d(r,t),s.setCapabilities(i),this.managePinListener(s),this._ioPins[r]=s,s._capabilities[d.I2C]&&this._i2cPins.push(s.number),i={},r++,n++):(i[e[n]]=e[n+1],n+=2);this._numPorts=Math.ceil(r/8);for(var c=0;c<this._numPorts;c++)this._digitalPort[c]=0;this._totalPins=r,this._totalAnalogPins=o,this.queryAnalogMapping()},c.processAnalogMappingResponse=function(e){for(var t=e.length,s=1;t>s;s++)127!==e[s]&&(this._analogPinMapping[e[s]]=s-1,this.getPin(s-1).setAnalogNumber(e[s]));this.startup()},c.startup=function(){this._isReady=!0,this.emit(g.READY)},c.systemReset=function(){this.send(I)},c.processPinStateResponse=function(e){if(!(this._numPinStateRequests<=0)){var t,s=e.length,i=e[1],n=e[2],r=this._ioPins[i];s>4?t=this.getValueFromTwo7bitBytes(e[3],e[4]):s>3&&(t=e[3]),r._type!==n&&(r.setType(n),this.managePinListener(r)),r.setState(t),this._numPinStateRequests--,this._numPinStateRequests<0&&(this._numPinStateRequests=0),this._pinStateEventCenter.emit(i,r),this.emit(g.PIN_STATE_RESPONSE,{pin:r})}},c.toDec=function(e){e=e.substring(0,1);var t=e.charCodeAt(0);return t},c.managePinListener=function(e){if(e._type===d.DOUT||e._type===d.AOUT||e._type===d.SERVO)h.listenerCount(e,f.CHANGE)||e.on(f.CHANGE,this._sendOutHandler);else if(h.listenerCount(e,f.CHANGE))try{e.removeListener(f.CHANGE,this._sendOutHandler)}catch(t){a("debug: caught pin removeEventListener exception")}},c.sendAnalogData=function(e,t){var s=this.getDigitalPin(e).analogWriteResolution;t*=s,t=0>t?0:t,t=t>s?s:t,e>15||t>Math.pow(2,14)?this.sendExtendedAnalogData(e,t):this.send([m|15&e,127&t,t>>7&127])},c.sendExtendedAnalogData=function(e,t){var s=[];if(t>Math.pow(2,16))throw new Error("error: Extended Analog values > 16 bits are not currently supported by StandardFirmata");s[0]=A,s[1]=O,s[2]=e,s[3]=127&t,s[4]=t>>7&127,t>=Math.pow(2,14)&&(s[5]=t>>14&127),s.push(b),this.send(s)},c.sendDigitalData=function(e,t){var s=Math.floor(e/8);if(t===d.HIGH)this._digitalPort[s]|=t<<e%8;else{if(t!==d.LOW)throw new Error("Invalid value passed to sendDigital, value must be 0 or 1.");this._digitalPort[s]&=~(1<<e%8)}this.sendDigitalPort(s,this._digitalPort[s])},c.sendServoData=function(e,t){var s=this.getDigitalPin(e);s._type===d.SERVO&&s.lastValue!==t&&this.sendAnalogData(e,t)},c.queryCapabilities=function(){this.send([A,N,b])},c.queryAnalogMapping=function(){this.send([A,C,b])},c.getValueFromTwo7bitBytes=function(e,t){return t<<7|e},c.getTransport=function(){return this._transport},c.setTransport=function(t){var s,i=e.transport[t];if(this._transport instanceof l){try{this._transport.close()}catch(n){}this._transport.removeAllListeners(),delete this._transport}i&&(s=new i(this._options))instanceof l&&(this._transport=s,s.on(u.READY,this._readyHandler),s.on(u.MESSAGE,this._messageHandler),s.on(u.ERROR,this._errorHandler))},c.reportVersion=function(){this.send(w)},c.reportFirmware=function(){this.send([A,U,b])},c.enableDigitalPins=function(){for(var e=0;e<this._numPorts;e++)this.sendDigitalPortReporting(e,d.ON)},c.disableDigitalPins=function(){for(var e=0;e<this._numPorts;e++)this.sendDigitalPortReporting(e,d.OFF)},c.sendDigitalPortReporting=function(e,t){this.send([E|e,t])},c.enableAnalogPin=function(e){this.sendAnalogPinReporting(e,d.ON)},c.disableAnalogPin=function(e){this.sendAnalogPinReporting(e,d.OFF)},c.sendAnalogPinReporting=function(e,t){this.send([v|e,t])},c.setDigitalPinMode=function(e,t,s){this.getDigitalPin(e).setType(t),this.managePinListener(this.getDigitalPin(e)),s&&s===!0||this.send([y,e,t])},c.setAnalogPinMode=function(e,t,s){this.getAnalogPin(e).setType(t),s&&s===!0||this.send([y,e,t])},c.enablePullUp=function(e){this.sendDigitalData(e,d.HIGH)},c.getFirmwareName=function(){return this._firmwareName},c.getFirmwareVersion=function(){return this._firmwareVersion},c.getPinCapabilities=function(){var e,t,s,i,n=[],r={0:"input",1:"output",2:"analog",3:"pwm",4:"servo",5:"shift",6:"i2c",7:"onewire",8:"stepper"};e=this._ioPins.length;for(var o=0;e>o;o++){t={},s=this._ioPins[o]._capabilities,i=!1;for(var a in s)s.hasOwnProperty(a)&&(i=!0,a>=0&&(t[r[a]]=this._ioPins[o]._capabilities[a]));n[o]=i?t:{"not available":"0"}}return n},c.queryPinState=function(e,t){var s=this,i=[],n=[];if(e=_.isArray(e)?e:[e],"function"==typeof t){var r=s._pinStateEventCenter.once.bind(s._pinStateEventCenter);e.forEach(function(e){i.push(_.promisify(r,function(e){this.resolve(e)})(e.number))}),Promise.all(i).then(function(e){t.call(s,e.length>1?e:e[0])})}e.forEach(function(e){n=n.concat([A,R,e.number,b]),s._numPinStateRequests++}),s.send(n)},c.sendDigitalPort=function(e,t){this.send([p|15&e,127&t,t>>7])},c.sendString=function(e){for(var t=[],s=0,i=e.length;i>s;s++)t.push(127&this.toDec(e[s])),t.push(this.toDec(e[s])>>7&127);this.sendSysex(S,t)},c.sendSysex=function(e,t){var s=[];s[0]=A,s[1]=e;for(var i=0,n=t.length;n>i;i++)s.push(t[i]);s.push(b),this.send(s)},c.sendServoAttach=function(e,t,s){var i,n=[];t=t||544,s=s||2400,n[0]=A,n[1]=M,n[2]=e,n[3]=t%128,n[4]=t>>7,n[5]=s%128,n[6]=s>>7,n[7]=b,this.send(n),i=this.getDigitalPin(e),i.setType(d.SERVO),this.managePinListener(i)},c.getPin=function(e){return this._ioPins[e]},c.getAnalogPin=function(e){return this._ioPins[this._analogPinMapping[e]]},c.getDigitalPin=function(e){return this._ioPins[this._digitalPinMapping[e]]},c.getPins=function(){return this._ioPins},c.analogToDigital=function(e){return this.getAnalogPin(e).number},c.getPinCount=function(){return this._totalPins},c.getAnalogPinCount=function(){return this._totalAnalogPins},c.getI2cPins=function(){return this._i2cPins},c.reportCapabilities=function(){for(var e,t=this.getPinCapabilities(),s=t.length,i=0;s>i;i++){a("Pin "+i+":");for(var n in t[i])t[i].hasOwnProperty(n)&&(e=t[i][n],a("	"+n+" ("+e+(e>1?" bits)":" bit)")))}},c.send=function(e){this._transport.send(e)},c.close=function(){this._transport.close()},e.BoardEvent=g,e.Board=t}),+function(e){"undefined"==typeof exports?e(webduino||{}):module.exports=e}(function(e){"use strict";function t(e){"string"==typeof e&&(e={device:e}),e=o.extend(o.extend({},s()),e),e.url=i(e.server)+"/",c.call(this,e)}function s(){return{transport:"mqtt",server:t.DEFAULT_SERVER,login:"admin",password:"password"}}function i(e){return 0===e.indexOf("ws://")||0===e.indexOf("wss://")?e:("undefined"!=typeof location&&"https:"===location.protocol?"wss://":"ws://")+e}function n(e,t){e._transport.emit(a.MESSAGE,t)}var r,o=e.util,a=e.TransportEvent,c=e.Board;t.prototype=r=Object.create(c.prototype,{constructor:{value:t}}),r.reportFirmware=function(){var e=[240,121,2,4,119,0,101,0,98,0,100,0,117,0,105,0,110,0,111,0,46,0,105,0,110,0,111,0,247];n(this,e)},r.queryCapabilities=function(){var e=[240,108,127,127,0,1,1,1,4,14,127,0,1,1,1,3,8,4,14,127,0,1,1,1,4,14,127,0,1,1,1,3,8,4,14,127,0,1,1,1,3,8,4,14,127,0,1,1,1,4,14,127,0,1,1,1,4,14,127,0,1,1,1,3,8,4,14,127,0,1,1,1,3,8,4,14,127,0,1,1,1,3,8,4,14,127,0,1,1,1,4,14,127,0,1,1,1,4,14,127,0,1,1,1,2,10,4,14,127,0,1,1,1,2,10,4,14,127,0,1,1,1,2,10,4,14,127,0,1,1,1,2,10,4,14,127,0,1,1,1,2,10,4,14,127,0,1,1,1,2,10,4,14,127,2,10,127,2,10,127,247];n(this,e)},r.queryAnalogMapping=function(){var e=[240,106,127,127,127,127,127,127,127,127,127,127,127,127,127,127,0,1,2,3,4,5,6,7,247];n(this,e)},r.startup=function(){var e=[144,0,0,145,0,0,146,0,0];c.prototype.startup.call(this),n(this,e)},t.DEFAULT_SERVER="wss://ws.webduino.io",e.WebArduino=t});